
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>مستندات سیبچه</title>
    <link href="../images/favicon.ico" rel="icon" type="image/ico" />
    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="../stylesheets/screenRTL-bdf6d5c2.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/printRTL-5d213acc.css" rel="stylesheet" media="print" />
      <script src="../javascripts/all-c5541673.js"></script>
  </head>

  <body class="fa fa_index" data-languages="[&quot;swift&quot;,&quot;objective_c&quot;,&quot;csharp&quot;,&quot;lua&quot;,&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="../images/logo-b40e35f9.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="swift">Swift</a>
              <a href="#" data-language-name="objective_c">Objective-C</a>
              <a href="#" data-language-name="csharp">C#</a>
              <a href="#" data-language-name="lua">Lua</a>
              <a href="#" data-language-name="javascript">Javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#da13914a70" class="toc-h1 toc-link" data-title="مستندات سیبچه">مستندات سیبچه</a>
          </li>
          <li>
            <a href="#598dbc49ab" class="toc-h1 toc-link" data-title="نصب کیت توسعه‌دهندگان">نصب کیت توسعه‌دهندگان</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#c3ccac9166" class="toc-h2 toc-link" data-title="نیازمندیهای نصب کیت توسعه دهندگان">نیازمندیهای نصب کیت توسعه دهندگان</a>
                  </li>
                  <li>
                    <a href="#598dbc49ab-2" class="toc-h2 toc-link" data-title="نصب کیت توسعه‌دهندگان">نصب کیت توسعه‌دهندگان</a>
                  </li>
                  <li>
                    <a href="#db41eec830" class="toc-h2 toc-link" data-title="تنظیمات اولیه">تنظیمات اولیه</a>
                  </li>
                  <li>
                    <a href="#5a60f35ea5" class="toc-h2 toc-link" data-title="کلاس‌های مورد استفاده در کیت توسعه‌دهندگان">کلاس‌های مورد استفاده در کیت توسعه‌دهندگان</a>
                  </li>
                  <li>
                    <a href="#c9f8a646e3" class="toc-h2 toc-link" data-title="گرفتن لیست بسته‌های قابل خرید">گرفتن لیست بسته‌های قابل خرید</a>
                  </li>
                  <li>
                    <a href="#78717ca14a" class="toc-h2 toc-link" data-title="گرفتن اطلاعات بسته مشخص">گرفتن اطلاعات بسته مشخص</a>
                  </li>
                  <li>
                    <a href="#24a3f3148b" class="toc-h2 toc-link" data-title="خرید بسته مشخص">خرید بسته مشخص</a>
                  </li>
                  <li>
                    <a href="#a0e825d6e5" class="toc-h2 toc-link" data-title="گرفتن لیست بسته های خریداری شده">گرفتن لیست بسته های خریداری شده</a>
                  </li>
                  <li>
                    <a href="#0c1fd2b399" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت کلاینت">مصرف کردن بسته‌ها در سمت کلاینت</a>
                  </li>
                  <li>
                    <a href="#11d829c26b" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت سرور">مصرف کردن بسته‌ها در سمت سرور</a>
                  </li>
                  <li>
                    <a href="#login" class="toc-h2 toc-link" data-title="درخواست وارد شدن (Login) کاربر به کیت توسعه‌دهندگان سیبچه">درخواست وارد شدن (Login) کاربر به کیت توسعه‌دهندگان سیبچه</a>
                  </li>
                  <li>
                    <a href="#logout" class="toc-h2 toc-link" data-title="درخواست خارج شدن (Logout) کاربر از کیت توسعه‌دهندگان سیبچه">درخواست خارج شدن (Logout) کاربر از کیت توسعه‌دهندگان سیبچه</a>
                  </li>
                  <li>
                    <a href="#82c79511e7" class="toc-h2 toc-link" data-title="گرفتن اطلاعات کاربر فعلی">گرفتن اطلاعات کاربر فعلی</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#e125b67c49" class="toc-h1 toc-link" data-title="نصب کیت توسعه‌دهندگان یونیتی">نصب کیت توسعه‌دهندگان یونیتی</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#aab4600c58" class="toc-h2 toc-link" data-title="نیازمندیهای نصب کیت توسعه دهندگان یونیتی">نیازمندیهای نصب کیت توسعه دهندگان یونیتی</a>
                  </li>
                  <li>
                    <a href="#e125b67c49-2" class="toc-h2 toc-link" data-title="نصب کیت توسعه‌دهندگان یونیتی">نصب کیت توسعه‌دهندگان یونیتی</a>
                  </li>
                  <li>
                    <a href="#767f8214f1" class="toc-h2 toc-link" data-title="تنظیمات اولیه (یونیتی)">تنظیمات اولیه (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#cc55425d65" class="toc-h2 toc-link" data-title="کلاس‌های مورد استفاده در کیت توسعه‌دهندگان (یونیتی)">کلاس‌های مورد استفاده در کیت توسعه‌دهندگان (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#682a187819" class="toc-h2 toc-link" data-title="گرفتن لیست بسته‌های قابل خرید (یونیتی)">گرفتن لیست بسته‌های قابل خرید (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#1e81198568" class="toc-h2 toc-link" data-title="گرفتن اطلاعات بسته مشخص (یونیتی)">گرفتن اطلاعات بسته مشخص (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#f404587b47" class="toc-h2 toc-link" data-title="خرید بسته مشخص (یونیتی)">خرید بسته مشخص (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#3a818b8ee6" class="toc-h2 toc-link" data-title="گرفتن لیست بسته های خریداری شده (یونیتی)">گرفتن لیست بسته های خریداری شده (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#b9afd625bc" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت کلاینت (یونیتی)">مصرف کردن بسته‌ها در سمت کلاینت (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#213f6d00ef" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت سرور (یونیتی)">مصرف کردن بسته‌ها در سمت سرور (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#594cd23ed6" class="toc-h2 toc-link" data-title="درخواست وارد شدن کاربر به کیت توسعه‌دهندگان سیبچه (یونیتی)">درخواست وارد شدن کاربر به کیت توسعه‌دهندگان سیبچه (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#81e5b98c7f" class="toc-h2 toc-link" data-title="درخواست خارج شدن کاربر از کیت توسعه‌دهندگان سیبچه (یونیتی)">درخواست خارج شدن کاربر از کیت توسعه‌دهندگان سیبچه (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#2b6b665703" class="toc-h2 toc-link" data-title="گرفتن اطلاعات کاربر فعلی (یونیتی)">گرفتن اطلاعات کاربر فعلی (یونیتی)</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#f6e7c5b604" class="toc-h1 toc-link" data-title="نصب کیت توسعه‌دهندگان کرونا">نصب کیت توسعه‌دهندگان کرونا</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#13c85fc10e" class="toc-h2 toc-link" data-title="نیازمندیهای نصب پلاگین کرونا">نیازمندیهای نصب پلاگین کرونا</a>
                  </li>
                  <li>
                    <a href="#bc461473bd" class="toc-h2 toc-link" data-title="نصب پلاگین کرونا">نصب پلاگین کرونا</a>
                  </li>
                  <li>
                    <a href="#48350e1384" class="toc-h2 toc-link" data-title="اضافه کردن کیت توسعه‌دهندگان سیبچه به پروژه کرونا">اضافه کردن کیت توسعه‌دهندگان سیبچه به پروژه کرونا</a>
                  </li>
                  <li>
                    <a href="#dcdb1d2bb8" class="toc-h2 toc-link" data-title="تنظیمات اولیه (کرونا)">تنظیمات اولیه (کرونا)</a>
                  </li>
                  <li>
                    <a href="#86b572b07a" class="toc-h2 toc-link" data-title="آبجکت‌های مورد استفاده در پلاگین سیبچه (کرونا)">آبجکت‌های مورد استفاده در پلاگین سیبچه (کرونا)</a>
                  </li>
                  <li>
                    <a href="#fed232f0e8" class="toc-h2 toc-link" data-title="گرفتن لیست بسته‌های قابل خرید (کرونا)">گرفتن لیست بسته‌های قابل خرید (کرونا)</a>
                  </li>
                  <li>
                    <a href="#f0f320b724" class="toc-h2 toc-link" data-title="گرفتن اطلاعات بسته مشخص (کرونا)">گرفتن اطلاعات بسته مشخص (کرونا)</a>
                  </li>
                  <li>
                    <a href="#1307a6b0bb" class="toc-h2 toc-link" data-title="خرید بسته مشخص (کرونا)">خرید بسته مشخص (کرونا)</a>
                  </li>
                  <li>
                    <a href="#4c033389c3" class="toc-h2 toc-link" data-title="گرفتن لیست بسته های خریداری شده (کرونا)">گرفتن لیست بسته های خریداری شده (کرونا)</a>
                  </li>
                  <li>
                    <a href="#1c9ec096d9" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت کلاینت (کرونا)">مصرف کردن بسته‌ها در سمت کلاینت (کرونا)</a>
                  </li>
                  <li>
                    <a href="#213f6d00ef" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت سرور (یونیتی)">مصرف کردن بسته‌ها در سمت سرور (یونیتی)</a>
                  </li>
                  <li>
                    <a href="#0fd9870786" class="toc-h2 toc-link" data-title="درخواست وارد شدن کاربر داخل پلاگین سیبچه (کرونا)">درخواست وارد شدن کاربر داخل پلاگین سیبچه (کرونا)</a>
                  </li>
                  <li>
                    <a href="#b04669d089" class="toc-h2 toc-link" data-title="درخواست خارج شدن کاربر از پلاگین سیبچه (کرونا)">درخواست خارج شدن کاربر از پلاگین سیبچه (کرونا)</a>
                  </li>
                  <li>
                    <a href="#36767fbe2a" class="toc-h2 toc-link" data-title="گرفتن اطلاعات کاربر فعلی (کرونا)">گرفتن اطلاعات کاربر فعلی (کرونا)</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#c7bda9ded8" class="toc-h1 toc-link" data-title="نصب کیت توسعه‌دهندگان ری‌اکت نیتیو">نصب کیت توسعه‌دهندگان ری‌اکت نیتیو</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#c3ccac9166" class="toc-h2 toc-link" data-title="نیازمندیهای نصب کیت توسعه دهندگان">نیازمندیهای نصب کیت توسعه دهندگان</a>
                  </li>
                  <li>
                    <a href="#c7bda9ded8-2" class="toc-h2 toc-link" data-title="نصب کیت توسعه‌دهندگان ری‌اکت نیتیو">نصب کیت توسعه‌دهندگان ری‌اکت نیتیو</a>
                  </li>
                  <li>
                    <a href="#db41eec830" class="toc-h2 toc-link" data-title="تنظیمات اولیه">تنظیمات اولیه</a>
                  </li>
                  <li>
                    <a href="#5a60f35ea5" class="toc-h2 toc-link" data-title="کلاس‌های مورد استفاده در کیت توسعه‌دهندگان">کلاس‌های مورد استفاده در کیت توسعه‌دهندگان</a>
                  </li>
                  <li>
                    <a href="#c9f8a646e3" class="toc-h2 toc-link" data-title="گرفتن لیست بسته‌های قابل خرید">گرفتن لیست بسته‌های قابل خرید</a>
                  </li>
                  <li>
                    <a href="#78717ca14a" class="toc-h2 toc-link" data-title="گرفتن اطلاعات بسته مشخص">گرفتن اطلاعات بسته مشخص</a>
                  </li>
                  <li>
                    <a href="#24a3f3148b" class="toc-h2 toc-link" data-title="خرید بسته مشخص">خرید بسته مشخص</a>
                  </li>
                  <li>
                    <a href="#a0e825d6e5" class="toc-h2 toc-link" data-title="گرفتن لیست بسته های خریداری شده">گرفتن لیست بسته های خریداری شده</a>
                  </li>
                  <li>
                    <a href="#0c1fd2b399" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت کلاینت">مصرف کردن بسته‌ها در سمت کلاینت</a>
                  </li>
                  <li>
                    <a href="#11d829c26b" class="toc-h2 toc-link" data-title="مصرف کردن بسته‌ها در سمت سرور">مصرف کردن بسته‌ها در سمت سرور</a>
                  </li>
                  <li>
                    <a href="#login" class="toc-h2 toc-link" data-title="درخواست وارد شدن (Login) کاربر به کیت توسعه‌دهندگان سیبچه">درخواست وارد شدن (Login) کاربر به کیت توسعه‌دهندگان سیبچه</a>
                  </li>
                  <li>
                    <a href="#logout" class="toc-h2 toc-link" data-title="درخواست خارج شدن (Logout) کاربر از کیت توسعه‌دهندگان سیبچه">درخواست خارج شدن (Logout) کاربر از کیت توسعه‌دهندگان سیبچه</a>
                  </li>
                  <li>
                    <a href="#82c79511e7" class="toc-h2 toc-link" data-title="گرفتن اطلاعات کاربر فعلی">گرفتن اطلاعات کاربر فعلی</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='/en'>English version</a></li>
            <li><a href='https://sibche.com/developer'>پنل توسعه‌دهندگان</a></li>
            <li><a href='https://github.com/sibche/docs/issues'>اعلام مشکل در مستندات</a></li>
            <li><a href='https://github.com/lord/slate'>قدرت‌گرفته از Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='da13914a70'>مستندات سیبچه</h1>
<p>به مستندات سیبچه خوش آمدید.<br/><br/>
  در صورتی که توسعه‌دهنده یونیتی هستید، مستندات مربوط به خود را می‌توانید از منوی سمت راست با انتخاب مورد «نصب کیت توسعه‌دهندگان یونیتی» پیدا کنید؛ همچنین اگر توسعه‌دهنده کرونا هستید، بایستی گزینه «نصب کیت توسعه دهندگان کرونا» را انتخاب کنید و در غیر اینصورت مستندات زیرشاخه «نصب کیت توسعه‌دهندگان» را بررسی و مطالعه نمایید.<br/><br/>
در هر قسمت از مستندات، از منوی بالا سمت چپ می‌توانید زبان برنامه‌نویسی خود را انتخاب کنید.<br/>
 (در صورتی که توسعه‌دهنده یونیتی هستید، بایستی #C را به عنوان زبان انتخاب کنید و در صورتی که توسعه‌دهنده کرونا هستید، زبان Lua را اننخاب نمایید.)<br/><br/>
موفق باشید :)</p>
<h1 id='598dbc49ab'>نصب کیت توسعه‌دهندگان</h1><h2 id='c3ccac9166'>نیازمندیهای نصب کیت توسعه دهندگان</h2>
<ol>
<li>بارگذاری برنامه در <a href="https://sibche.com/developer">پنل توسعه‌دهندگان سیبچه</a></li>
<li>دریافت کلید برنامه از پنل توسعه‌دهندگان</li>
<li>آخرین نسخه‌ی Xcode</li>
</ol>
<h2 id='598dbc49ab-2'>نصب کیت توسعه‌دهندگان</h2><h3 id='cocoapods'>نصب از طریق Cocoapods</h3>
<p>کافی است دستور روبرو را بر روی فایل podfile خود اضافه نمایید:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">pod</span> <span class="s1">'SibcheStoreKit'</span><span class="p">,</span> <span class="s1">'~&gt; 4.1'</span>
</code></pre>
<blockquote>
<p>سپس پاد اضافه‌شده را نصب نمایید</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>pod repo update
pod install
</code></pre><h3 id='bc95e8754c'>نصب دستی</h3>
<p>کیت توسعه‌دهندگان سیبچه را می‌توانید از <a href="https://github.com/sibche/SibcheStoreKit/releases/latest/download/SibcheStoreKit.zip">اینجا</a> دانلود کرده و به پروژه خود اضافه کنید. برای اینکار فایل دانلود شده را از حالت زیپ در بیاورید. سپس فایل SibcheStoreKit.framework را به داخل پروژه خود کپی کرده و همانند زیر به پروژه اضافه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc1.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc1.jpg"/>
</a></p>

<p>سپس فایل پلاگین را انتخاب نموده و گزینه <code>add</code> را بزنید. سپس همانند شکل زیر، از بخش <code>General</code> از داخل تنظیمات پروژه، SibcheStoreKit.framework را از قسمت <code>Linked Frameworks and Libraries</code> حذف نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc2.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc2.jpg"/>
</a></p>

<p>سپس دکمه + از بخش <code>Embedded Binaries</code> را انتخاب نموده و <code>SibcheStoreKit.framework</code> را انتخاب نموده و دکمه <code>Add</code> را بزنید. همانند عکسهای زیر:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc3.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc3.jpg"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc4.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc4.jpg"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc5.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc5.jpg"/>
</a></p>
<h2 id='db41eec830'>تنظیمات اولیه</h2><h3 id='scheme'>افزودن Scheme مختص برنامه شما</h3>
<aside class="success">
اگر برنامه شما دارای scheme اختصاصی می‌باشد این مرحله را رد کنید.
</aside>

<p>برای اضافه کردن scheme اختصاصی بایستی طبق مراحل زیر تنظیمات برنامه را داخل Xcode باز کرده و سپس به تب info مراجعه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc10.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc10.jpg"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc11.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc11.jpg"/>
</a></p>

<p>سپس همانند شکل، url اختصاصی اپلیکیشن را اضافه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc12.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc12.jpg"/>
</a></p>

<p>به جای test، نام دلخواهی را تنظیم کرده و به جای testapp بایستی scheme مورد نظرتان را وارد نمایید. به عنوان مثال scheme تنظیم شده <strong>تلگرام</strong> <code>tg</code> و scheme تنظیم شده برای برنامه <strong>اینستاگرام</strong> <code>instagram</code> میباشد. لیست کامل scheme برنامه‌های معروف را میتوانید از
<a href="https://ios.gadgethacks.com/news/always-updated-list-ios-app-url-scheme-names-0184033/">اینجا</a>
مشاهده نمایید.</p>

<aside class="warning">
توصیه اکید می‌شود از scheme استفاده کنید که مختص شما باشد و ترجیحا طولانی باشد. توجه فرمایید که اگر با برنامه‌های دیگر در تداخل باشد، در فرآیند پرداخت دچار مشکل خواهید شد.
</aside>
<h3 id='appdelegate'>افزودن کیت توسعه‌دهنده به AppDelegate</h3><pre class="highlight objective_c tab-objective_c"><code><span class="cp">#import "AppDelegate.h"
#import &lt;SibcheStoreKit/SibcheStoreKit.h&gt;
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">application</span><span class="p">:(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">initWithApiKey</span><span class="p">:</span><span class="n">YOUR_API_KEY</span> <span class="nf">withScheme</span><span class="p">:</span><span class="n">YOUR_SCHEME</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">SibcheStoreKit</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">LaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="nf">initWithApiKey</span><span class="p">(</span><span class="kt">YOUR_API_KEY</span><span class="p">,</span> <span class="nv">withScheme</span><span class="p">:</span> <span class="kt">YOUR_SCHEME</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<p>ابتدا کد اجرای کیت توسعه‌دهندگان را داخل تابع <code>didFinishLaunchingWithOptions</code> اضافه نمایید:</p>

<p><br/></p>

<p>لازم به ذکر است که به جای <code>YOUR_API_KEY</code> بایستی کلید برنامه گرفته شده از پنل توسعه‌دهندگان سیبچه را قرار دهید و به جای <code>YOUR_SCHEME</code> واژه scheme اضافه شده در مرحله قبل را جایگذاری نمایید.</p>

<p><br/>
<br/></p>
<pre class="highlight objective_c tab-objective_c"><code><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">application</span><span class="p">:(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">app</span> <span class="nf">openURL</span><span class="p">:(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span> <span class="nf">options</span><span class="p">:(</span><span class="n">NSDictionary</span><span class="o">&lt;</span><span class="n">UIApplicationOpenURLOptionsKey</span><span class="p">,</span><span class="n">id</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">options</span><span class="p">{</span>
    <span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">openUrl</span><span class="p">:</span><span class="n">url</span> <span class="nf">options</span><span class="p">:</span><span class="n">options</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">app</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">OpenURLOptionsKey</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="nf">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<p>سپس امکان فراخوانی باز شدن url را نیز به کیت توسعه‌دهندگان بدهید:</p>
<h2 id='5a60f35ea5'>کلاس‌های مورد استفاده در کیت توسعه‌دهندگان</h2>
<p>برای خرید، فعال‌سازی و استفاده از بسته‌های سیبچه، کلاسهای زیر ایجاد شده است که در ادامه در مورد هر کدام توضیحاتی ارائه خواهیم کرد.</p>

<ul>
<li><p><code>SibchePackage</code>:
این کلاس، نمایانگر بسته قابل خریدی هست که داخل پنل توسعه‌دهندگان اقدام به تعریفشان کرده‌اید. </p></li>
<li><p><code>SibchePurchasePackage</code>:
این کلاس، نمایانگر خرید متناظری از کاربر هست که به یک بسته SibchePackage اختصاص یافته است. این کلاس، شامل اطلاعات خرید، زمان خرید، و تاریخ انقضا و ... خواهد بود.</p></li>
<li><p><code>SibcheError</code>:
این کلاس، در مواقع رخداد خطا به شما ارجاع داده خواهد شد که شامل اطلاعات بیشتر از خطاهای رخ داده است. اطلاعاتی از قبیل خطا و Http status code و ...</p></li>
</ul>
<h3 id='sibchepackage'>SibchePackage</h3>
<p>سه نوع بسته قابل خرید داریم که عبارتند از:</p>

<ul>
<li>بسته‌های قابل خرید مصرفی یا <code>SibcheConsumablePackage</code>:
بسته‌هایی که قابل مصرف هستند که خریداری شده و داخل بازی یا برنامه مصرف می‌شود. مانند بسته‌ی ۵۰۰ سکه طلا یا شارژ قابل مصرف داخل برنامه.</li>
</ul>

<p>این بسته ها تا زمانی که مصرف نشده‌اند، فعال و معتبر می‌باشند و پس از مصرف، قابل خرید مجدد هستند. </p>

<ul>
<li>بسته‌های قابل خرید غیر مصرفی یا <code>SibcheNonConsumablePackage</code>:
بسته‌هایی که قابل مصرف نیستند و فقط یکبار خریداری می‌شوند. مانند بسته‌ی باز شدن قابلیت آپلود آواتار یا تغییر نام.</li>
</ul>

<p>این بسته ها، فقط یکبار قابل خرید هستند و پس از خرید، همواره در لیست بسته‌های فعال کاربر خواهند بود.</p>

<ul>
<li>بسته‌های اشتراک یا <code>SibcheSubscriptionPackage</code>:
بسته‌هایی هستند که به مدت محدود قابل استفاده بوده و پس از اتمام زمان آنها، کاربر مجاز به استفاده از آن قابلیت نیست. به عنوان مثال، قابلیت استفاده از امکانات ویژه به مدت یک سال</li>
</ul>
<pre class="highlight objective_c tab-objective_c"><code><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">packageId</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">type</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">code</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">name</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">packageDescription</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">price</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">totalPrice</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">discount</span><span class="p">;</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="k">var</span> <span class="nv">packageId</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">code</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">packageDescription</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">price</span><span class="p">:</span> <span class="kt">NSNumber</span>
<span class="k">var</span> <span class="nv">totalPrice</span><span class="p">:</span> <span class="kt">NSNumber</span>
<span class="k">var</span> <span class="nv">discount</span><span class="p">:</span> <span class="kt">NSNumber</span>
</code></pre>
<p>همه این سه مدل از مدل والد <code>SibchePackage</code> گرفته شده‌اند و به صورت عمومی شامل توابع روبرو هستند.</p>

<p><br/>
<br/>
<br/>
<br/>
<br/>
<br/></p>
<pre class="highlight objective_c tab-objective_c"><code><span class="k">-</span> <span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">duration</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">group</span><span class="p">;</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="k">var</span> <span class="nv">duration</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">group</span><span class="p">:</span> <span class="kt">String</span>
</code></pre>
<p>علاوه بر این توابع، کلاس <code>SibcheSubscriptionPackage</code> شامل توابع اضافی تر روبرو نیز هست:</p>
<h3 id='sibchepurchasepackage'>SibchePurchasePackage</h3><pre class="highlight objective_c tab-objective_c"><code><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">purchasePackageId</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">type</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">code</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSDate</span><span class="o">*</span><span class="p">)</span><span class="n">expireAt</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSDate</span><span class="o">*</span><span class="p">)</span><span class="n">createdAt</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">SibchePackage</span><span class="o">*</span><span class="p">)</span><span class="n">package</span><span class="p">;</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="k">var</span> <span class="nv">purchasePackageId</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">code</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">expireAt</span><span class="p">:</span> <span class="kt">NSDate</span>
<span class="k">var</span> <span class="nv">createdAt</span><span class="p">:</span> <span class="kt">NSDate</span>
<span class="k">var</span> <span class="nv">package</span><span class="p">:</span> <span class="kt">SibchePackage</span>
</code></pre>
<p>این کلاس، شامل تناظر خرید کاربر به بسته‌های شما می‌باشد. این کلاس شامل توابع روبروست:</p>

<p><br/>
<br/>
<br/></p>
<h3 id='sibcheerror'>SibcheError</h3><pre class="highlight objective_c tab-objective_c"><code><span class="k">@property</span> <span class="n">NSNumber</span><span class="o">*</span> <span class="n">errorCode</span><span class="p">;</span>
<span class="k">@property</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">message</span><span class="p">;</span>
<span class="k">@property</span> <span class="n">NSNumber</span><span class="o">*</span> <span class="n">statusCode</span><span class="p">;</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="k">var</span> <span class="nv">NSNumber</span><span class="p">:</span> <span class="n">errorCode</span>
<span class="k">var</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">var</span> <span class="nv">NSNumber</span><span class="p">:</span> <span class="n">statusCode</span>
</code></pre>
<p>این کلاس در مواقع بروز خطا به شما داده خواهد شد و شامل خصوصیات روبرو می‌باشد:</p>

<p><br/>
<br/></p>

<ul>
<li>errorCode: همان شماره خطایی هست که مطابق جدول زیر ایجاد شده است.</li>
<li>message: پیغام خطایی هست که از طرف سرور دریافت شده است.</li>
<li>statusCode:  همان شماره خطای http هست که سرور در جواب درخواست ما داده است.</li>
</ul>

<table><thead>
<tr>
<th>شماره errorCode</th>
<th>دلیل خطای مربوطه</th>
</tr>
</thead><tbody>
<tr>
<td>1000</td>
<td>خطای نامشخص</td>
</tr>
<tr>
<td>1001</td>
<td>این بسته قبلا خریداری شده است</td>
</tr>
<tr>
<td>1002</td>
<td>کاربر از ادامه عملیات منصرف شد</td>
</tr>
<tr>
<td>1003</td>
<td>در فرایند ورود (لاگین) دچار مشکل شده‌ایم</td>
</tr>
<tr>
<td>1004</td>
<td>برنامه به درستی initiate نشده است</td>
</tr>
</tbody></table>
<h2 id='c9f8a646e3'>گرفتن لیست بسته‌های قابل خرید</h2><pre class="highlight objective_c tab-objective_c"><code><span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">fetchInAppPurchasePackages</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span><span class="o">*</span> <span class="n">error</span><span class="p">,</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">packagesArray</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your block code for handling of packages list
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="n">fetch</span> <span class="p">{</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">packagesArray</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Your block code for handling of packages list</span>
<span class="p">}</span>
</code></pre>
<p>پس از تنظیم برنامه، میتوانید بسته‌های قابل خرید را مشاهده نمایید. کافیست همانند کد روبرو اقدام به فراخوانی تابع مورد نظر نمایید:</p>

<p><br/></p>

<p>در پاسخ، در صورت موفقیت، کیت توسعه‌دهندگان بسته‌های قابل خرید را به عنوان پارامتر پاسخ به شما تحویل میدهد. این پارامتر آرایه‌ای از بسته‌های قابل خرید می‌باشد. این بسته‌ها از نوع <code>SibchePackage</code> هستند. </p>

<p>در صورت ناموفق بودن درخواست، پارمتری با نام error از نوع <code>‍‍SibcheError</code> ارسال می‌شود.</p>
<h2 id='78717ca14a'>گرفتن اطلاعات بسته مشخص</h2><pre class="highlight objective_c tab-objective_c"><code><span class="c1">// Both package bundle code &amp; package id is acceptable
</span>
<span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">fetchInAppPurchasePackage</span><span class="p">:</span><span class="s">@"com.example.testapp"</span> <span class="nf">withPackagesCallback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span><span class="o">*</span> <span class="n">error</span><span class="p">,</span> <span class="n">SibchePackage</span> <span class="o">*</span><span class="n">package</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// Your block code for handling of packages list
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="c1">// Both package bundle code &amp; package id is acceptable</span>

<span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nv">inAppPurchasePackage</span><span class="p">:</span> <span class="s">"com.example.testapp"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Your block code for handling of packages list</span>
<span class="p">}</span>
</code></pre>
<p>با در اختیار داشتن آیدی یا کد باندل بسته مورد نظر می‌توانید اطلاعات آن بسته را در اختیار بگیرید. نحوه استفاده از این API به شکل روبرو است:</p>

<p><br/></p>

<p>پارامتر اول داده شده، همان callback ارسال شده ما است که پس از مشخص شدن وضعیت درخواست، فراخوانی خواهد شد. در صورت موفقیت، بسته‌ی مورد نظر در قالب آبجکت <code>SibchePackage</code> (بسته به نوع بسته) به شما ارسال خواهد شد.</p>
<h2 id='24a3f3148b'>خرید بسته مشخص</h2><pre class="highlight objective_c tab-objective_c"><code><span class="c1">// Both package bundle code &amp; package id is acceptable
</span>
<span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">purchasePackage</span><span class="p">:</span><span class="s">@"com.example.testapp"</span> <span class="nf">withCallback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span><span class="o">*</span> <span class="n">error</span><span class="p">,</span> <span class="n">SibchePurchasePackage</span><span class="o">*</span> <span class="n">purchasePackage</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your block code for handling of purchase callback
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="c1">// Both package bundle code &amp; package id is acceptable</span>

<span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="nf">purchasePackage</span><span class="p">(</span><span class="s">"com.example.testapp"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">purchasePackage</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// Your block code for handling of purchase callback</span>
<span class="p">}</span>
</code></pre>
<p>پس از گرفتن لیست بسته‌ها، میتوانید درخواست خرید این بسته‌ها را از طریق کد روبرو به کیت توسعه‌دهندگان بدهید. در ادامه، کیت توسعه‌دهندگان، در صورت نیاز کاربر را لاگین کرده و فرایند پرداخت را پیگیری خواهد کرد. سپس موفق یا ناموفق بودن خرید را به همراه <code>SibchePurchasePackage</code> به اطلاع شما خواهد رساند.</p>

<p><br/></p>
<h2 id='a0e825d6e5'>گرفتن لیست بسته های خریداری شده</h2><pre class="highlight objective_c tab-objective_c"><code><span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">fetchActiveInAppPurchasePackages</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span><span class="o">*</span> <span class="n">error</span><span class="p">,</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">purchasePackagesArray</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Your block code for handling of packages list
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="n">fetchActive</span> <span class="p">{</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">purchasePackagesArray</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// Your block code for handling of packages list</span>
<span class="p">}</span>
</code></pre>
<p>با استفاده از این دستور، میتوانید لیست بسته‌های فعال (خریداری شده) کاربر را بدست آورید. کافیست همانند کد روبر، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>

<p><br/>
<br/></p>

<p>در پاسخ، کیت توسعه‌دهندگان موفقیت/عدم موفقیت درخواست و نیز آرایه‌ای از بسته‌های خریداری شده‌ی فعال را برمی‌گرداند. توجه نمایید که این آرایه، آرایه‌ای از نوع <code>SibchePurchasePackage</code> است.</p>

<p>منظور از بسته‌های فعال، بسته‌هایی هستند که خریداری شده‌اند و هنوز مصرف نشده‌اند و یا تاریخ انقضایشان به اتمام نرسیده است.
تعریف سیبچه از بسته‌های فعال برای هر کدام از نوع بسته‌ها به شرح زیر می‌باشد:</p>

<ul>
<li><code>SibcheConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز مصرف (Consume) نشده‌اند.</li>
<li><code>SibcheNonConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند. چون این بسته‌ها یکبار خرید هستند، در صورت خرید، به صورت مادام‌العمر فعال هستند.</li>
<li><code>SibcheSubscriptionPackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز از تاریخ انقضای آنها باقی مانده است.</li>
</ul>
<h2 id='0c1fd2b399'>مصرف کردن بسته‌ها در سمت کلاینت</h2>
<aside class="success">
در صورتی که بخواهید بسته‌های قابل مصرف را در سمت کلاینت (درون خود بازی/برنامه) مصرف کنید، بایستی از این روش استفاده کنید. ولی اگر قصد مصرف و اعتبارسنجی سمت سرور داشته باشید، به بخش بعدی مراجعه نمایید.
</aside>
<pre class="highlight objective_c tab-objective_c"><code><span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">consumePurchasePackage</span><span class="p">:</span><span class="n">purchasePackageData</span><span class="p">.</span><span class="n">purchasePackageId</span> <span class="nf">withCallback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span><span class="o">*</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// Your block code for handling of package consume
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="nf">consumePurchasePackage</span><span class="p">(</span><span class="n">purchasePackageData</span><span class="o">.</span><span class="n">purchasePackageId</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// Your block code for handling of package consume</span>
<span class="p">}</span>
</code></pre>
<p>برای مصرف کردن بسته‌های قابل مصرف (Consumable) بایستی شبیه دستور زیر، تابع مربوطه از کیت توسعه‌دهندگان را فراخوانی کنیم:</p>

<p>در پاسخ پس از مشخص شدن وضعیت درخواست، کیت توسعه‌دهندگان callback داده شده را فراخوانی خواهد کرد.
در صورت موفقیت، یعنی بسته مورد نظر با موفقیت مصرف شده و در صورت عدم موفقیت، در مصرف بسته مورد نظر، دچار مشکلی شده‌ایم.</p>
<h2 id='11d829c26b'>مصرف کردن بسته‌ها در سمت سرور</h2>
<p>برای این کار بایستی، کد <code>purchasePackageId</code> که بخشی از کلاس <code>SibchePurchasePackage</code> می‌باشد را در دست داشته باشید. سپس لینکی به شکل زیر درست کنید و دیتای وریفای را از سرور بگیرید <strong>(آدرس‌ها Case sensitive هستند!)</strong>:</p>

<p><code>https://api.sibche.com/sdk/userInAppPurchasePackages/{purchasePackageId}/verifyConsume</code></p>

<p>همچنین برای این درخواست، بایستی هدر HTTP با اسم <code>App-Key</code> تنظیم نمایید. این کلید از طریق پنل توسعه‌دهندگان به صورت اختصاصی برای هر برنامه قابل دریافت است. اسم این کلید، <strong>کلید سرور</strong> نام دارد و عبارت ۳۰ کاراکتری است.</p>
<pre class="highlight shell tab-shell"><code>curl --header <span class="s2">"App-Key: YOUR_SERVER_KEY"</span> -X POST <span class="se">\</span>
<span class="s1">'https://api.sibche.com/sdk/userInAppPurchasePackages/1/verifyConsume'</span>
</code></pre>
<p>نمونه کد قابل فراخوانی برای curl به شکل روبرو خواهد بود:</p>

<p><br/>
<br/></p>

<p>در جواب، سرور پاسخی با یکی از <strong>HTTP Response Code</strong> های زیر خواهد داد:</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"your package is already is used or not found"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 404 (Not Found):
در صورتی که آدرس لینک را اشتباه وارد کرده باشید، یا بسته مورد نظر با purchasePackageId اشتباه وارد شده باشد، یا بسته مورد نظر قبلا مصرف شده باشد این خطا رخ خواهد داد.<br>
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</li>
</ul>

<p><br/>
<br/></p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"app-key is not valid"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 401 (Unauthorized):
یعنی اینکه کلید سروری که بر روی App-Key تنظیم شده است، غیر معتبر و اشتباه است.
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</li>
</ul>

<p><br/>
<br/></p>

<ul>
<li>HTTP Status Code 202 (Accepted / OK):
در این صورت یعنی، بسته مورد نظر با موفقیت مصرف شد و خرید کاربر، معتبر بوده است.
برای این حالت،‌ سرور در متن پاسخ، هیچ نوشته‌ای بر نخواهد گرداند.</li>
</ul>
<h2 id='login'>درخواست وارد شدن (Login) کاربر به کیت توسعه‌دهندگان سیبچه</h2>
<aside class="warning">
توصیه می‌کنیم از این بخش به صورت دستی استفاده نکنید چرا که در فرآیند پرداخت، اگر کاربر لاگین نکرده باشد، کتابخانه سیبچه خود اقدام به لاگین کاربر می‌کند.
</aside>
<pre class="highlight objective_c tab-objective_c"><code><span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">loginUser</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isLoginSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span><span class="o">*</span> <span class="n">error</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userName</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your code for handling of login result
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="n">loginUser</span> <span class="p">{</span> <span class="p">(</span><span class="n">isLogginSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">userId</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Your code for handling of login result</span>
<span class="p">}</span>
</code></pre>
<p>با استفاده از این دستور، میتوانید به کتابخانه سیبچه، درخواست لاگین کاربر را بدهید. کافیست همانند کد روبر، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>

<p><br/>
<br/></p>

<p>در جواب، کیت توسعه دهندگان، موفقیت لاگین و اروری که بهش برخورده را برمیگرداند. همچنین، در صورت موفقیت و در صورت موجود بودن، نام کاربر و آیدی کاربر را برمی‌گرداند.</p>
<h2 id='logout'>درخواست خارج شدن (Logout) کاربر از کیت توسعه‌دهندگان سیبچه</h2>
<aside class="warning">
توصیه اکید میکنیم، زمانی از این تابع استفاده نمایید که کاربر دکمه بازیابی خرید را زده و درخواست بازیابی خرید خود را دارد.
</aside>
<pre class="highlight objective_c tab-objective_c"><code><span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">logoutUser</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
    <span class="c1">// Your code for handling of logout result
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="n">logoutUser</span> <span class="p">{</span>
    <span class="c1">// Your code for handling of logout result</span>
<span class="p">}</span>
</code></pre>
<p>با استفاده از این دستور می‌توانید کاربر فعلی لاگین کرده داخل سیستم را از کیت توسعه‌دهندگان خارج نمایید و کلیه اطلاعات session او را پاک نمایید.
این تابع پس از اتمام کار، در قالب callback به شما جواب خواهد داد.</p>
<h2 id='82c79511e7'>گرفتن اطلاعات کاربر فعلی</h2><pre class="highlight objective_c tab-objective_c"><code><span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">getCurrentUserData</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">LoginStatusType</span> <span class="n">loginStatus</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userCellphoneNumber</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your code for handling of get current user data result
</span><span class="p">}];</span>
</code></pre><pre class="highlight swift tab-swift"><code><span class="kt">SibcheStoreKit</span><span class="o">.</span><span class="n">getCurrentUserData</span> <span class="p">{</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">loginStatus</span><span class="p">,</span> <span class="n">userCellphoneNumber</span><span class="p">,</span> <span class="n">userId</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Your code for handling of get current user data result</span>
<span class="p">}</span>
</code></pre>
<p>زمانی که نیاز دارید تا شماره تلفن و نیز شماره کاربری (userId) کاربر را دریافت نمایید، می‌توانید از تابع روبرو استفاده نمایید.</p>

<p><br/>
<br/></p>

<p>در جواب، کیت توسعه‌دهندگان، نتیجه موفق بودن عملیات و نیز ارور رخ داده را برمی‌گرداند. در حالت عادی، بایستی عملیات موفق باشد ولی ناموفق بودن عملیات می‌تواند به دلایل شبکه‌ای مختلفی همانند موارد زیر باشد:</p>

<ul>
<li>دسترسی به اینترنت مقدور نبود</li>
<li>هر اتفاق ناخواسته شبکه‌ای رخ داده است</li>
<li>سرور سیبچه در دسترس نیست</li>
</ul>

<p>همچنین در جواب، پارامتر سومی هم دارد که وضعیت کاربر را از لحاظ لاگین بودن/نبودن به اطلاع شما می‌رساند. در صورتی که لاگین باشد، از نوع <code>‍loginStatusTypeIsLoggedIn‍‍</code> جواب خواهد داد. در صورت لاگین نبودن نیز جواب داده شده از نوع <code>loginStatusTypeIsLoggedOut</code> می‌باشد. در صورتی که عملیات ناموفق باشد و از وضعیت لاگین بودن کاربر مطمئن نباشیم نیز جواب ‍<code>loginStatusTypeHaveTokenButFailedToCheck</code> را خواهیم داد.
پارامتر‌های بعدی نیز شامل شماره تلفن کاربر و نیز id کاربر می‌باشد که در پاسخ به شما داده خواهد شد.</p>
<h1 id='e125b67c49'>نصب کیت توسعه‌دهندگان یونیتی</h1><h2 id='aab4600c58'>نیازمندیهای نصب کیت توسعه دهندگان یونیتی</h2>
<ol>
<li>بارگذاری برنامه در <a href="https://sibche.com/developer">پنل توسعه‌دهندگان سیبچه</a></li>
<li>دریافت کلید برنامه از پنل توسعه‌دهندگان</li>
<li>آخرین نسخه‌ی Xcode</li>
<li>داشتن unity v2019.1 به بالا</li>
</ol>
<h2 id='e125b67c49-2'>نصب کیت توسعه‌دهندگان یونیتی</h2>
<p>کیت توسعه‌دهندگان سیبچه مختص یونیتی را می‌توانید از <a href="https://github.com/sibche/SibcheStoreKit-Unity/releases/latest/download/SibcheStoreKit.unitypackage">اینجا</a> دانلود کرده و به پروژه خود اضافه کنید.</p>
<h2 id='767f8214f1'>تنظیمات اولیه (یونیتی)</h2>
<p>تنظیمات مورد نیاز پروژه به صورت خودکار داخل پروژه در زیربخش 
<code>Editor</code>
 اضافه شده است که فایلی با نام
<code>SibcheBuildPostProcessor.cs</code>
می‌باشد.</p>

<p>این فایل شامل دو بخش تنظیم می‌باشد که یکی برای اضافه کردن scheme یا همان url اختصاصی برای بازی شما می‌باشد و بخش دیگر، برای اضافه کردن فایل پروژه به صورت داینامیک به پروژه می‌باشد. در مورد هر دو بخش به تفضیل توضیح خواهیم داد. </p>
<h3 id='scheme'>افزودن Scheme مختص برنامه شما</h3>
<p>اگر برنامه شما دارای scheme یا url اختصاصی هست، بایستی این تنظیم را از بخش
<code>SibcheBuildPostProcessor.cs</code>
غیرفعال (کامنت) کنید.</p>

<p>همانند کد زیر می‌توانید url اختصاصی خود را بر روی پروژه تنظیم نمایید.</p>
<pre class="highlight csharp tab-csharp"><code><span class="nf">AddCustomUrlScheme</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"testapp"</span><span class="p">,</span> <span class="s">"test"</span><span class="p">);</span>
</code></pre>
<p>به جای test، نام دلخواهی را تنظیم کرده و به جای testapp بایستی scheme مورد نظرتان را وارد نمایید. به عنوان مثال scheme تنظیم شده <strong>تلگرام</strong> <code>tg</code> و scheme تنظیم شده برای برنامه <strong>اینستاگرام</strong> <code>instagram</code> میباشد. لیست کامل scheme برنامه‌های معروف را میتوانید از
<a href="https://ios.gadgethacks.com/news/always-updated-list-ios-app-url-scheme-names-0184033/">اینجا</a>
مشاهده نمایید.</p>

<p>توصیه اکید می‌شود از scheme استفاده کنید که مختص شما باشد و ترجیحا طولانی باشد. توجه فرمایید که اگر با برنامه‌های دیگر در تداخل باشد، در فرآیند پرداخت دچار مشکل خواهید شد.</p>
<h3 id='framework-embedded-framework'>افزودن فایل .framework به عنوان کتابخانه دینامیک (embedded framework)</h3>
<p>این بخش نیز کلیه تنظیمات مربوط به دینامیک کردن پروژه را انجام داده و کافیست اجازه دهید به همان شکلی که هست باقی بماند:</p>
<pre class="highlight csharp tab-csharp"><code><span class="nf">AddSibcheFrameworkAsEmbed</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
</code></pre><h3 id='init'>افزودن init اولیه کتابخانه سیبچه</h3>
<p>در جایی از ورودی کلاس اصلی (تابع Start) بایستی تابع init کتابخانه سیبچه را فراخوانی نمایید تا برای استفاده‌های آتی آماده شده باشد:</p>
<pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">SibcheStoreKit</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">GameController</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//Other initiation tasks</span>

        <span class="c1">// Sibche StoreKit initiation</span>
        <span class="n">Sibche</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">YOUR_API_KEY</span><span class="p">,</span> <span class="n">YOUR_SCHEME</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
<p>به جای <code>YOUR_API_KEY</code> بایستی api key دریافت شده از پنل دولوپری سیبچه را وارد نمایید. همچنین به جای <code>YOUR_SCHEME‍</code> بایستی scheme تعریف شده از مراحل قبلی را وارد نمایید.</p>
<h2 id='cc55425d65'>کلاس‌های مورد استفاده در کیت توسعه‌دهندگان (یونیتی)</h2>
<p>برای خرید، فعال‌سازی و استفاده از بسته‌های سیبچه، کلاسهای زیر ایجاد شده است که در ادامه در مورد هر کدام توضیحاتی ارائه خواهیم کرد.</p>

<ul>
<li><p><code>SibchePackage</code>: این کلاس، نمایانگر بسته قابل خریدی هست که داخل پنل توسعه‌دهندگان اقدام به تعریفشان کرده‌اید. </p></li>
<li><p><code>SibchePurchasePackage</code>: این کلاس، نمایانگر خرید متناظری از کاربر هست که به یک بسته SibchePackage اختصاص یافته است. این کلاس، شامل اطلاعات خرید، زمان خرید، و تاریخ انقضا و ... خواهد بود.</p></li>
<li><p><code>SibcheError</code>:این کلاس، در مواقع رخداد خطا به شما ارجاع داده خواهد شد که شامل اطلاعات بیشتر از خطاهای رخ داده است. اطلاعاتی از قبیل خطا و Http status code و ...</p></li>
</ul>
<h3 id='sibchepackage'>SibchePackage</h3>
<p>سه نوع بسته قابل خرید داریم که عبارتند از:</p>

<ul>
<li>
بسته‌های قابل خرید مصرفی یا <code>SibcheConsumablePackage</code>:
بسته‌هایی که قابل مصرف هستند که خریداری شده و داخل بازی یا برنامه مصرف می‌شود. مانند بسته‌ی ۵۰۰ سکه طلا یا شارژ قابل مصرف داخل برنامه.</li>
</ul>

<p>این بسته ها تا زمانی که مصرف نشده‌اند، فعال و معتبر می‌باشند و پس از مصرف، قابل خرید مجدد هستند. </p>

<ul>
<li>
بسته‌های قابل خرید غیر مصرفی یا <code>SibcheNonConsumablePackage</code>:
بسته‌هایی که قابل مصرف نیستند و فقط یکبار خریداری می‌شوند. مانند بسته‌ی باز شدن قابلیت آپلود آواتار یا تغییر نام.</li>
</ul>

<p>این بسته ها، فقط یکبار قابل خرید هستند و پس از خرید، همواره در لیست بسته‌های فعال کاربر خواهند بود.</p>

<ul>
<li>
بسته‌های اشتراک یا <code>SibcheSubscriptionPackage</code>:
بسته‌هایی هستند که به مدت محدود قابل استفاده بوده و پس از اتمام زمان آنها، کاربر مجاز به استفاده از آن قابلیت نیست. به عنوان مثال، قابلیت استفاده از امکانات ویژه به مدت یک سال</li>
</ul>

<p>همه این سه کلاس از کلاس والد <code>SibchePackage</code> گرفته شده‌اند و به صورت عمومی شامل خصوصیات زیر هستند.</p>
<pre class="highlight csharp tab-csharp"><code><span class="k">public</span> <span class="kt">string</span> <span class="n">packageId</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">type</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">code</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">packageDescription</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">price</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">totalPrice</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">discount</span><span class="p">;</span>
</code></pre>
<p>علاوه بر این توابع، کلاس <code>SibcheSubscriptionPackage</code> شامل خصوصیات اضافی‌تر زیر نیز هست:</p>
<pre class="highlight csharp tab-csharp"><code><span class="k">public</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="k">group</span><span class="p">;</span>
</code></pre><h3 id='sibchepurchasepackage'>SibchePurchasePackage</h3>
<p>این کلاس، شامل تناظر خرید کاربر به بسته‌های شما می‌باشد. این کلاس شامل خصوصیات زیر است:</p>
<pre class="highlight csharp tab-csharp"><code><span class="k">public</span> <span class="kt">string</span> <span class="n">purchasePackageId</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">type</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">code</span><span class="p">;</span>
<span class="k">public</span> <span class="n">DateTime</span> <span class="n">expireAt</span><span class="p">;</span>
<span class="k">public</span> <span class="n">DateTime</span> <span class="n">createdAt</span><span class="p">;</span>
<span class="k">public</span> <span class="n">SibchePackage</span> <span class="n">package</span><span class="p">;</span>
</code></pre><h3 id='sibcheerror'>SibcheError</h3>
<p>این کلاس در مواقع بروز خطا به شما داده خواهد شد و شامل خصوصیات زیر می‌باشد:</p>
<pre class="highlight csharp tab-csharp"><code><span class="k">public</span> <span class="kt">string</span> <span class="n">message</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">errorCode</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">statusCode</span><span class="p">;</span>
</code></pre>
<ul>
<li>errorCode: همان شماره خطایی هست که مطابق جدول زیر ایجاد شده است.</li>
<li>message: پیغام خطایی هست که از طرف سرور دریافت شده است.</li>
<li>statusCode:  همان شماره خطای http هست که سرور در جواب درخواست ما داده است.</li>
</ul>

<table><thead>
<tr>
<th>شماره errorCode</th>
<th>دلیل خطای مربوطه</th>
</tr>
</thead><tbody>
<tr>
<td>1000</td>
<td>خطای نامشخص</td>
</tr>
<tr>
<td>1001</td>
<td>این بسته قبلا خریداری شده است</td>
</tr>
<tr>
<td>1002</td>
<td>کاربر از ادامه عملیات منصرف شد</td>
</tr>
<tr>
<td>1003</td>
<td>در فرایند ورود (لاگین) دچار مشکل شده‌ایم</td>
</tr>
<tr>
<td>1004</td>
<td>برنامه به درستی initiate نشده است</td>
</tr>
</tbody></table>
<h2 id='682a187819'>گرفتن لیست بسته‌های قابل خرید (یونیتی)</h2>
<p>پس از تنظیم برنامه، میتوانید بسته‌های قابل خرید را مشاهده نمایید. کافیست همانند کد زیر، اقدام به فراخوانی تابع مورد نظر نمایید:</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">FetchPackages</span><span class="p">((</span><span class="kt">bool</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SibchePackage</span><span class="p">&gt;</span> <span class="n">packages</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Success block</span>
    <span class="p">}</span> <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// failure block</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>در پاسخ، در صورت موفقیت، کیت توسعه‌دهندگان بسته‌های قابل خرید را به عنوان پارامتر پاسخ به شما تحویل میدهد. این پارامتر آرایه‌ای از بسته‌های قابل خرید می‌باشد. این بسته‌ها از نوع <code>SibchePackage</code> هستند. </p>

<p>در صورت ناموفق بودن درخواست، پارمتری با نام error از نوع <code>‍‍SibcheError</code> ارسال می‌شود، وگرنه به صورت null داده خواهد شد.</p>
<h2 id='1e81198568'>گرفتن اطلاعات بسته مشخص (یونیتی)</h2>
<p>با در اختیار داشتن آیدی یا کد باندل بسته مورد نظر می‌توانید اطلاعات آن بسته را در اختیار بگیرید. نحوه استفاده از این API به شکل زیر است:</p>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// Both package bundle code &amp; package id is acceptable</span>
<span class="n">Sibche</span><span class="p">.</span><span class="nf">FetchPackage</span><span class="p">(</span><span class="n">packageId</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">isSuccessful1</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">,</span> <span class="n">SibchePackage</span> <span class="n">package</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Success block</span>
    <span class="p">}</span> <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// failure block</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>پارامتر اول داده شده، همان callback ارسال شده ما است که پس از مشخص شدن وضعیت درخواست، فراخوانی خواهد شد. در صورت موفقیت، بسته‌ی مورد نظر در قالب آبجکت <code>SibchePackage</code> (بسته به نوع بسته) به شما ارسال خواهد شد.</p>
<h2 id='f404587b47'>خرید بسته مشخص (یونیتی)</h2>
<p>پس از گرفتن لیست بسته‌ها، میتوانید درخواست خرید این بسته‌ها را از طریق کد روبرو به کیت توسعه‌دهندگان بدهید. در ادامه، کیت توسعه‌دهندگان، در صورت نیاز کاربر را لاگین کرده و فرایند پرداخت را پیگیری خواهد کرد. سپس موفق یا ناموفق بودن خرید را به همراه <code>SibchePurchasePackage</code> به اطلاع شما خواهد رساند.</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">Purchase</span><span class="p">(</span><span class="n">packageCode</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">,</span> <span class="n">SibchePurchasePackage</span> <span class="n">purchasedPackage</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Success block</span>
    <span class="p">}</span> <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// failure block</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre><h2 id='3a818b8ee6'>گرفتن لیست بسته های خریداری شده (یونیتی)</h2>
<p>با استفاده از این دستور، میتوانید لیست بسته‌های فعال (خریداری شده) کاربر را بدست آورید. کافیست همانند کد زیر، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">FetchActivePackages</span><span class="p">((</span><span class="kt">bool</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SibchePurchasePackage</span><span class="p">&gt;</span> <span class="n">purchasedPackages</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Success block</span>
    <span class="p">}</span> <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// failure block</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>در پاسخ، کیت توسعه‌دهندگان موفقیت/عدم موفقیت درخواست و نیز آرایه‌ای از بسته‌های خریداری شده‌ی فعال را برمی‌گرداند. توجه نمایید که این آرایه، آرایه‌ای از نوع <code>SibchePurchasePackage</code> است.</p>

<p>منظور از بسته‌های فعال، بسته‌هایی هستند که خریداری شده‌اند و هنوز مصرف نشده‌اند و یا تاریخ انقضایشان به اتمام نرسیده است.
تعریف سیبچه از بسته‌های فعال برای هر کدام از نوع بسته‌ها به شرح زیر می‌باشد:</p>

<ul>
<li><code>SibcheConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز مصرف (Consume) نشده‌اند.</li>
<li><code>SibcheNonConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند. چون این بسته‌ها یکبار خرید هستند، در صورت خرید، به صورت مادام‌العمر فعال هستند.</li>
<li><code>SibcheSubscriptionPackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز از تاریخ انقضای آنها باقی مانده است.</li>
</ul>
<h2 id='b9afd625bc'>مصرف کردن بسته‌ها در سمت کلاینت (یونیتی)</h2>
<p>در صورتی که بخواهید بسته‌های قابل مصرف را در سمت کلاینت (درون خود بازی/برنامه) مصرف کنید، بایستی از این روش استفاده کنید. ولی اگر قصد مصرف و اعتبارسنجی سمت سرور داشته باشید، به بخش بعدی مراجعه نمایید.</p>

<p>برای مصرف کردن بسته‌های قابل مصرف (Consumable) بایستی شبیه دستور زیر، تابع مربوطه از کیت توسعه‌دهندگان را فراخوانی کنیم:</p>

<p>در پاسخ پس از مشخص شدن وضعیت درخواست، کیت توسعه‌دهندگان callback داده شده را فراخوانی خواهد کرد.
در صورت موفقیت، یعنی بسته مورد نظر با موفقیت مصرف شده و در صورت عدم موفقیت، در مصرف بسته مورد نظر، دچار مشکلی شده‌ایم.</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">Consume</span><span class="p">(</span><span class="n">purchasedPackage</span><span class="p">.</span><span class="n">purchasePackageId</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Success block</span>
    <span class="p">}</span> <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// failure block</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre><h2 id='213f6d00ef'>مصرف کردن بسته‌ها در سمت سرور (یونیتی)</h2>
<p>برای این کار بایستی، کد <code>purchasePackageId</code> که بخشی از کلاس <code>SibchePurchasePackage</code> می‌باشد را در دست داشته باشید. سپس لینکی به شکل زیر درست کنید و دیتای وریفای را از سرور بگیرید <strong>(آدرس‌ها Case sensitive هستند!)</strong>:</p>

<p><code>https://api.sibche.com/sdk/userInAppPurchasePackages/{purchasePackageId}/verifyConsume</code></p>

<p>همچنین برای این درخواست، بایستی هدر HTTP با اسم <code>App-Key</code> تنظیم نمایید. این کلید از طریق پنل توسعه‌دهندگان به صورت اختصاصی برای هر برنامه قابل دریافت است. اسم این کلید، <strong>کلید سرور</strong> نام دارد و عبارت ۳۰ کاراکتری است.</p>

<p>نمونه کد قابل فراخوانی برای curl به شکل زیر خواهد بود:</p>
<pre class="highlight shell tab-shell"><code>curl --header <span class="s2">"App-Key: YOUR_SERVER_KEY"</span> -X POST <span class="se">\</span>
<span class="s1">'https://api.sibche.com/sdk/userInAppPurchasePackages/1/verifyConsume'</span>
</code></pre>
<p>در جواب، سرور پاسخی با یکی از <strong>HTTP Response Code</strong> های زیر خواهد داد:</p>

<ul>
<li>HTTP Status Code 404 (Not Found):</li>
</ul>

<p>در صورتی که آدرس لینک را اشتباه وارد کرده باشید، یا بسته مورد نظر با purchasePackageId اشتباه وارد شده باشد، یا بسته مورد نظر قبلا مصرف شده باشد این خطا رخ خواهد داد.<br>
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"your package is already is used or not found"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 401 (Unauthorized):</li>
</ul>

<p>یعنی اینکه کلید سروری که بر روی App-Key تنظیم شده است، غیر معتبر و اشتباه است.
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"app-key is not valid"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 202 (Accepted / OK):</li>
</ul>

<p>در این صورت یعنی، بسته مورد نظر با موفقیت مصرف شد و خرید کاربر، معتبر بوده است.
برای این حالت،‌ سرور در متن پاسخ، هیچ نوشته‌ای بر نخواهد گرداند.</p>
<h2 id='594cd23ed6'>درخواست وارد شدن کاربر به کیت توسعه‌دهندگان سیبچه (یونیتی)</h2>
<p>توصیه می‌کنیم از این بخش به صورت دستی استفاده نکنید چرا که در فرآیند پرداخت، اگر کاربر لاگین نکرده باشد، کتابخانه سیبچه خود اقدام به لاگین کاربر می‌کند.</p>

<p>با استفاده از این دستور، میتوانید به کتابخانه سیبچه، درخواست لاگین کاربر را بدهید. کافیست همانند کد زیر، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">Login</span><span class="p">((</span><span class="kt">bool</span> <span class="n">isLoginSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userId</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// Login handle block</span>
<span class="p">});</span>
</code></pre>
<p>در جواب، کیت توسعه دهندگان، موفقیت لاگین و اروری که بهش برخورده را برمیگرداند. همچنین، در صورت موفقیت و در صورت موجود بودن، نام کاربر و آیدی کاربر را برمی‌گرداند.</p>
<h2 id='81e5b98c7f'>درخواست خارج شدن کاربر از کیت توسعه‌دهندگان سیبچه (یونیتی)</h2>
<p>توصیه می‌کنیم، زمانی از این تابع استفاده نمایید که کاربر دکمه بازیابی خرید را زده و درخواست بازیابی خرید خود را دارد.</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">Logout</span><span class="p">(()</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// Logout handle block</span>
<span class="p">});</span>
</code></pre>
<p>با استفاده از این دستور می‌توانید کاربر فعلی لاگین کرده داخل سیستم را از کیت توسعه‌دهندگان خارج نمایید و کلیه اطلاعات session او را پاک نمایید.
این تابع پس از اتمام کار، در قالب callback به شما جواب خواهد داد.</p>
<h2 id='2b6b665703'>گرفتن اطلاعات کاربر فعلی (یونیتی)</h2>
<p>زمانی که نیاز دارید تا شماره تلفن و نیز شماره کاربری (userId) کاربر را دریافت نمایید، می‌توانید از تابع زیر استفاده نمایید.</p>
<pre class="highlight csharp tab-csharp"><code><span class="n">Sibche</span><span class="p">.</span><span class="nf">GetCurrentUserData</span><span class="p">((</span><span class="kt">bool</span> <span class="n">isSuccessful</span><span class="p">,</span> <span class="n">SibcheError</span> <span class="n">error</span><span class="p">,</span> <span class="n">LoginStatusType</span> <span class="n">loginStatus</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userCellphoneNumber</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userId</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// GetCurrentUserData handle block</span>
<span class="p">});</span>
</code></pre>
<p>در جواب، کیت توسعه‌دهندگان، نتیجه موفق بودن عملیات و نیز ارور رخ داده را برمی‌گرداند. در حالت عادی، بایستی عملیات موفق باشد ولی ناموفق بودن عملیات می‌تواند به دلایل شبکه‌ای مختلفی همانند موارد زیر باشد:</p>

<ul>
<li>دسترسی به اینترنت مقدور نبود</li>
<li>هر اتفاق ناخواسته شبکه‌ای رخ داده است</li>
<li>سرور سیبچه در دسترس نیست</li>
</ul>

<p>همچنین در جواب، پارامتر سومی هم دارد که وضعیت کاربر را از لحاظ لاگین بودن/نبودن به اطلاع شما می‌رساند. در صورتی که لاگین باشد، از نوع <code>‍loginStatusTypeIsLoggedIn‍‍</code> جواب خواهد داد. در صورت لاگین نبودن نیز جواب داده شده از نوع <code>loginStatusTypeIsLoggedOut</code> می‌باشد. در صورتی که عملیات ناموفق باشد و از وضعیت لاگین بودن کاربر مطمئن نباشیم نیز جواب ‍<code>loginStatusTypeHaveTokenButFailedToCheck</code> را خواهیم داد.
پارامتر‌های بعدی نیز شامل شماره تلفن کاربر و نیز id کاربر می‌باشد که در پاسخ به شما داده خواهد شد.</p>
<h1 id='f6e7c5b604'>نصب کیت توسعه‌دهندگان کرونا</h1><h2 id='13c85fc10e'>نیازمندیهای نصب پلاگین کرونا</h2>
<ol>
<li>بارگذاری برنامه در <a href="https://sibche.com/developer">پنل توسعه‌دهندگان سیبچه</a></li>
<li>دریافت کلید برنامه از پنل توسعه‌دهندگان</li>
<li>آخرین نسخه‌ی Xcode</li>
<li>داشتن آخرین نسخه از کرونا</li>
</ol>
<h2 id='bc461473bd'>نصب پلاگین کرونا</h2><h3 id='fade4a5de0'>اضافه کردن پلاگین سیبچه به صورت دستی به پروژه کرونا</h3>
<p>ابتدا <a href="https://github.com/sibche/SibcheStoreKit-Corona/releases/latest/download/SibcheStoreKit.zip">این فایل</a> را دانلود کرده و از حال زیپ در بیاورید و داخل پوشه پروژه Xcode تان اضافه نمایید.</p>

<p>سپس همانند تصاویر زیر، این فایل را به پروژه Xcode خود اضافه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc1.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc1.png"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc2.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc2.png"/>
</a></p>
<h2 id='48350e1384'>اضافه کردن کیت توسعه‌دهندگان سیبچه به پروژه کرونا</h2>
<p>به دلیل اینکه کیت توسعه‌دهندگان سیبچه به صورت پویا (دینامیک) کار می‌کند، بایستی فایل <code>SibcheStoreKit.framework</code> را به صورت دستی به پروژه اضافه نماییم. در این مرحله همانند تصاویر زیر، این فایل را که داخل پوشه <code>EmbeddedFrameworks</code> از پوشه دانلود شده قرار دارد، همانند تصاویر زیر به پروژه اضافه می‌کنیم:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc3.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc3.png"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc4.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc4.png"/>
</a></p>

<p>سپس فایل پلاگین را انتخاب نموده و گزینه <code>add</code> را بزنید. سپس همانند شکل زیر، از بخش <code>General</code> از داخل تنظیمات پروژه، SibcheStoreKit.framework را از قسمت <code>Linked Frameworks and Libraries</code> حذف نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc5.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc5.png"/>
</a></p>

<p>سپس دکمه + از بخش <code>Embedded Binaries</code> را انتخاب نموده و <code>SibcheStoreKit.framework</code> را انتخاب نموده و دکمه <code>Add</code> را بزنید. همانند عکسهای زیر:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc6.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc6.png"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc7.png">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Screenshots/Sc7.png"/>
</a></p>
<h2 id='dcdb1d2bb8'>تنظیمات اولیه (کرونا)</h2><h3 id='scheme'>افزودن Scheme مختص برنامه شما</h3>
<aside class="success">
اگر برنامه شما دارای scheme اختصاصی می‌باشد این مرحله را رد کنید.
</aside>

<p>برای اضافه کردن scheme اختصاصی بایستی طبق مراحل زیر تنظیمات برنامه را داخل Xcode باز کرده و سپس به تب info مراجعه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc10.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc10.jpg"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc11.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc11.jpg"/>
</a></p>

<p>سپس همانند شکل، url اختصاصی اپلیکیشن را اضافه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc12.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc12.jpg"/>
</a></p>

<p>به جای test، نام دلخواهی را تنظیم کرده و به جای testapp بایستی scheme مورد نظرتان را وارد نمایید. به عنوان مثال scheme تنظیم شده <strong>تلگرام</strong> <code>tg</code> و scheme تنظیم شده برای برنامه <strong>اینستاگرام</strong> <code>instagram</code> میباشد. لیست کامل scheme برنامه‌های معروف را میتوانید از
<a href="https://ios.gadgethacks.com/news/always-updated-list-ios-app-url-scheme-names-0184033/">اینجا</a>
مشاهده نمایید.</p>

<aside class="warning">
توصیه اکید می‌شود از scheme استفاده کنید که مختص شما باشد و ترجیحا طولانی باشد. توجه فرمایید که اگر با برنامه‌های دیگر در تداخل باشد، در فرآیند پرداخت دچار مشکل خواهید شد.
</aside>
<h3 id='wrapper'>افزودن فایل wrapper پروژه</h3>
<p>فایل <code>wrapper.lua</code> را از <a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Corona/sibche/wrapper.lua">اینجا</a> دانلود کرده و سپس داخل فولدری به اسم <code>sibche</code> داخل پروژه کرونا اضافه کنید.</p>

<p>این فایل وظیفه ساده‌سازی API های پلاگین سیبچه را بر عهده دارد. همچنین ورودی‌ها و خروجی‌های API ها را به صورت خلاصه داخل این فایل توضیح داده‌ایم.</p>
<h3 id='init'>افزودن init اولیه کتابخانه سیبچه</h3><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">SibcheStoreKit</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"sibche.wrapper"</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">YOUR_API_KEY</span><span class="p">,</span> <span class="n">YOUR_SCHEME</span><span class="p">)</span>
</code></pre>
<p>بایستی در ابتدای برنامه، پلاگین سیبچه را وارد کرده و متد <code>init</code> را همانند کد روبرو فراخوانی نمایید</p>

<p><br/>
<br/></p>

<p>به جای <code>YOUR_API_KEY</code> بایستی api key دریافت شده از پنل دولوپری سیبچه را وارد نمایید. همچنین به جای <code>YOUR_SCHEME‍</code> بایستی scheme تعریف شده از مراحل قبلی را وارد نمایید.</p>
<h2 id='86b572b07a'>آبجکت‌های مورد استفاده در پلاگین سیبچه (کرونا)</h2>
<p>برای خرید، فعال‌سازی و استفاده از بسته‌های سیبچه، آبجکت (table) های زیر ایجاد شده است که در ادامه در مورد هر کدام توضیحاتی ارائه خواهیم کرد.</p>

<ul>
<li><p><code>SibchePackage</code>: این آبجکت، نمایانگر بسته قابل خریدی هست که داخل پنل توسعه‌دهندگان اقدام به تعریفشان کرده‌اید. </p></li>
<li><p><code>SibchePurchasePackage</code>: این آبجکت، نمایانگر خرید متناظری از کاربر هست که به یک بسته SibchePackage اختصاص یافته است. این آبجکت، شامل اطلاعات خرید، زمان خرید، و تاریخ انقضا و ... خواهد بود.</p></li>
<li><p><code>SibcheError</code>:این آبجکت، در مواقع رخداد خطا به شما ارجاع داده خواهد شد که شامل اطلاعات بیشتر از خطاهای رخ داده است. اطلاعاتی از قبیل خطا و Http status code و ...</p></li>
</ul>
<h3 id='sibchepackage'>SibchePackage</h3>
<p>سه نوع بسته قابل خرید داریم که عبارتند از:</p>

<ul>
<li>
بسته‌های قابل خرید مصرفی یا <code>SibcheConsumablePackage</code>:
بسته‌هایی که قابل مصرف هستند که خریداری شده و داخل بازی یا برنامه مصرف می‌شود. مانند بسته‌ی ۵۰۰ سکه طلا یا شارژ قابل مصرف داخل برنامه.</li>
</ul>

<p>این بسته ها تا زمانی که مصرف نشده‌اند، فعال و معتبر می‌باشند و پس از مصرف، قابل خرید مجدد هستند. </p>

<ul>
<li>
بسته‌های قابل خرید غیر مصرفی یا <code>SibcheNonConsumablePackage</code>:
بسته‌هایی که قابل مصرف نیستند و فقط یکبار خریداری می‌شوند. مانند بسته‌ی باز شدن قابلیت آپلود آواتار یا تغییر نام.</li>
</ul>

<p>این بسته ها، فقط یکبار قابل خرید هستند و پس از خرید، همواره در لیست بسته‌های فعال کاربر خواهند بود.</p>

<ul>
<li>
بسته‌های اشتراک یا <code>SibcheSubscriptionPackage</code>:
بسته‌هایی هستند که به مدت محدود قابل استفاده بوده و پس از اتمام زمان آنها، کاربر مجاز به استفاده از آن قابلیت نیست. به عنوان مثال، قابلیت استفاده از امکانات ویژه به مدت یک سال</li>
</ul>

<p><br/></p>
<pre class="highlight lua tab-lua"><code><span class="c1">-- sibchePackage.packageId (string)</span>
<span class="c1">-- sibchePackage.type (string)</span>
<span class="c1">-- sibchePackage.code (string)</span>
<span class="c1">-- sibchePackage.name (string)</span>
<span class="c1">-- sibchePackage.packageDescription (string)</span>
<span class="c1">-- sibchePackage.price (int)</span>
<span class="c1">-- sibchePackage.totalPrice (int)</span>
<span class="c1">-- sibchePackage.discount (int)</span>
</code></pre>
<p>// TODO Check and fill DateTime types () empty brackets</p>

<p>همه این سه آبجکت از آبجکت والد <code>SibchePackage</code> گرفته شده‌اند و به صورت عمومی شامل خصوصیات روبرو هستند.</p>

<p><br/>
<br/>
<br/>
<br/>
<br/>
<br/></p>
<pre class="highlight lua tab-lua"><code><span class="c1">-- sibchePackage.duration (int)</span>
<span class="c1">-- sibchePackage.group (string)</span>
</code></pre>
<p>علاوه بر این خصوصیات، آبجکت <code>SibcheSubscriptionPackage</code> شامل خصوصیات اضافی‌تر روبرو نیز هست:</p>
<h3 id='sibchepurchasepackage'>SibchePurchasePackage</h3><pre class="highlight lua tab-lua"><code><span class="c1">-- sibchePurchasePackage.purchasePackageId (string)</span>
<span class="c1">-- sibchePurchasePackage.type (string)</span>
<span class="c1">-- sibchePurchasePackage.code (string)</span>
<span class="c1">-- sibchePurchasePackage.expireAt ()</span>
<span class="c1">-- sibchePurchasePackage.createdAt ()</span>
<span class="c1">-- sibchePurchasePackage.package (SibchePackage)</span>
</code></pre>
<p>این آبجکت، شامل تناظر خرید کاربر به بسته‌های شما می‌باشد. این آبجکت شامل خصوصیات روبرو است:</p>

<p><br/>
<br/>
<br/></p>
<h3 id='sibcheerror'>SibcheError</h3><pre class="highlight lua tab-lua"><code><span class="c1">-- event.errorMessage;</span>
<span class="c1">-- event.errorCode;</span>
<span class="c1">-- event.errorStatusCode;</span>
</code></pre>
<p>این آبجکت در مواقع بروز خطا داخل همان پارامترهای callback به شما داده خواهد شد و شامل خصوصیات زیر می‌باشد:</p>

<ul>
<li>errorCode: همان شماره خطایی هست که مطابق جدول زیر ایجاد شده است.</li>
<li>errorMessage: پیغام خطایی هست که از طرف سرور دریافت شده است.</li>
<li>errorStatusCode:  همان شماره خطای http هست که سرور در جواب درخواست ما داده است.</li>
</ul>

<table><thead>
<tr>
<th>شماره errorCode</th>
<th>دلیل خطای مربوطه</th>
</tr>
</thead><tbody>
<tr>
<td>1000</td>
<td>خطای نامشخص</td>
</tr>
<tr>
<td>1001</td>
<td>این بسته قبلا خریداری شده است</td>
</tr>
<tr>
<td>1002</td>
<td>کاربر از ادامه عملیات منصرف شد</td>
</tr>
<tr>
<td>1003</td>
<td>در فرایند ورود (لاگین) دچار مشکل شده‌ایم</td>
</tr>
<tr>
<td>1004</td>
<td>برنامه به درستی initiate نشده است</td>
</tr>
</tbody></table>
<h2 id='fed232f0e8'>گرفتن لیست بسته‌های قابل خرید (کرونا)</h2><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">fetchInAppPurchasePackagesCallback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">isSuccessful</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- success block: e.g. fill packages with event.packagesArray</span>
    <span class="k">else</span>
        <span class="c1">-- failure block: e.g. show error to user based on event.errorCode</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">fetchInAppPurchasePackages</span><span class="p">(</span><span class="n">fetchInAppPurchasePackagesCallback</span><span class="p">)</span>
</code></pre>
<p>پس از تنظیم برنامه، میتوانید بسته‌های قابل خرید را مشاهده نمایید. کافیست همانند کد روبرو اقدام به فراخوانی تابع مورد نظر نمایید:</p>

<aside class="success">
توجه نمایید که inspect استفاده شده، لایبرری ای جهت مشاهده محتویات table میباشد که از 
<a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit-Corona/master/Corona/inspect.lua">اینجا
</a>
قابل دریافت و استفاده است
</aside>

<p><br/>
<br/>
<br/></p>

<p>در پاسخ، در صورت موفقیت، پلاگین بسته‌های قابل خرید را به عنوان پارامتر پاسخ به شما تحویل میدهد. این پارامتر آرایه‌ای از بسته‌های قابل خرید می‌باشد. این بسته‌ها از نوع <code>SibchePackage</code> هستند. </p>

<p>در صورت ناموفق بودن درخواست، پارمترهایی با نام <code>errorMessage</code> و <code>errorCode</code> و <code>errorStatusCode</code> ارسال می‌شود، وگرنه به صورت null داده خواهد شد.</p>
<h2 id='f0f320b724'>گرفتن اطلاعات بسته مشخص (کرونا)</h2><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">fetchInAppPurchasePackageCallback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">isSuccessful</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- success block: e.g. use event.package into your game</span>
    <span class="k">else</span>
        <span class="c1">-- failure block: e.g. show error to user based on event.errorCode</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">fetchInAppPurchasePackage</span><span class="p">(</span><span class="err">ِ</span><span class="n">YOUR_PACKAGE_ID_OR_CODE</span><span class="p">,</span> <span class="n">fetchInAppPurchasePackageCallback</span><span class="p">)</span>
</code></pre>
<p>با در اختیار داشتن آیدی یا کد باندل بسته مورد نظر می‌توانید اطلاعات آن بسته را در اختیار بگیرید. نحوه استفاده از این API به شکل روبرو است:</p>

<p><br/>
<br/></p>

<p>پارامتر دوم داده شده، همان callback ارسال شده ما است که پس از مشخص شدن وضعیت درخواست، فراخوانی خواهد شد. در صورت موفقیت، بسته‌ی مورد نظر در قالب آبجکت <code>SibchePackage</code> (بسته به نوع بسته) به شما ارسال خواهد شد.</p>
<h2 id='1307a6b0bb'>خرید بسته مشخص (کرونا)</h2><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">purchasePackageCallback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">isSuccessful</span> <span class="ow">and</span> <span class="n">event</span><span class="p">.</span><span class="n">purchasePackage</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- success block</span>
    <span class="k">else</span>
        <span class="c1">-- failure block</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">purchasePackage</span><span class="p">(</span><span class="err">ِ</span><span class="n">YOUR_PACKAGE_ID_OR_CODE</span><span class="p">,</span> <span class="n">purchasePackageCallback</span><span class="p">)</span>
</code></pre>
<p>پس از گرفتن لیست بسته‌ها، میتوانید درخواست خرید این بسته‌ها را از طریق کد روبرو به پلاگین بدهید. در ادامه، کیت توسعه‌دهندگان، در صورت نیاز کاربر را لاگین کرده و فرایند پرداخت را پیگیری خواهد کرد. سپس موفق یا ناموفق بودن خرید را به همراه <code>SibchePurchasePackage</code> به اطلاع شما خواهد رساند.</p>
<h2 id='4c033389c3'>گرفتن لیست بسته های خریداری شده (کرونا)</h2><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">fetchActiveInAppPurchasePackagesCallback</span><span class="p">(</span> <span class="n">event</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">fetchActiveInAppPurchasePackages</span><span class="p">(</span><span class="n">fetchActiveInAppPurchasePackagesCallback</span><span class="p">)</span>
</code></pre>
<p>با استفاده از این دستور، میتوانید لیست بسته‌های فعال (خریداری شده) کاربر را بدست آورید. کافیست همانند کد روبرو، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>

<p><br/>
<br/>
<br/></p>

<p>در پاسخ، کیت توسعه‌دهندگان موفقیت/عدم موفقیت درخواست و نیز آرایه‌ای از بسته‌های خریداری شده‌ی فعال را برمی‌گرداند. توجه نمایید که این آرایه، آرایه‌ای از نوع <code>SibchePurchasePackage</code> است.</p>

<p>منظور از بسته‌های فعال، بسته‌هایی هستند که خریداری شده‌اند و هنوز مصرف نشده‌اند و یا تاریخ انقضایشان به اتمام نرسیده است.
تعریف سیبچه از بسته‌های فعال برای هر کدام از نوع بسته‌ها به شرح زیر می‌باشد:</p>

<ul>
<li><code>SibcheConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز مصرف (Consume) نشده‌اند.</li>
<li><code>SibcheNonConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند. چون این بسته‌ها یکبار خرید هستند، در صورت خرید، به صورت مادام‌العمر فعال هستند.</li>
<li><code>SibcheSubscriptionPackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز از تاریخ انقضای آنها باقی مانده است.</li>
</ul>
<h2 id='1c9ec096d9'>مصرف کردن بسته‌ها در سمت کلاینت (کرونا)</h2>
<aside class="warning">
در صورتی که بخواهید بسته‌های قابل مصرف را در سمت کلاینت (درون خود بازی/برنامه) مصرف کنید، بایستی از این روش استفاده کنید. ولی اگر قصد مصرف و اعتبارسنجی سمت سرور داشته باشید، به بخش بعدی مراجعه نمایید.
</aside>
<pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">consumePurchasePackageCallback</span><span class="p">(</span> <span class="n">event</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">purchasePackageCallback</span><span class="p">(</span> <span class="n">event</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">isSuccessful</span> <span class="ow">and</span> <span class="n">event</span><span class="p">.</span><span class="n">purchasePackage</span><span class="p">)</span> <span class="k">then</span>
        <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">purchasePackage</span><span class="p">.</span><span class="n">package</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"ConsumableInAppPackage"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">consumePurchasePackage</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">purchasePackage</span><span class="p">.</span><span class="n">purchasePackageId</span><span class="p">,</span> <span class="n">consumePurchasePackageCallback</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">purchasePackage</span><span class="p">(</span><span class="err">ِ</span><span class="n">YOUR_PACKAGE_ID_OR_CODE</span><span class="p">,</span> <span class="n">purchasePackageCallback</span><span class="p">)</span>
</code></pre>
<p>برای مصرف کردن بسته‌های قابل مصرف (Consumable) بایستی شبیه دستور روبرو، تابع مربوطه از پلاگین را فراخوانی کنیم:</p>

<p><br/>
<br/></p>

<aside class="success">
تکه کد روبرو، پس از خرید موفق، اقدام به مصرف بسته می‌کند و صرفا جهت نمایش نحوه استفاده از بسته نوشته شده است و بایستی متناسب کارکرد بازیتان تغییرش بدهید.
</aside>

<p><br/>
<br/>
<br/></p>

<p>در پاسخ پس از مشخص شدن وضعیت درخواست، کیت توسعه‌دهندگان callback داده شده را فراخوانی خواهد کرد.
در صورت موفقیت، یعنی بسته مورد نظر با موفقیت مصرف شده و در صورت عدم موفقیت، در مصرف بسته مورد نظر، دچار مشکلی شده‌ایم.</p>
<h2 id='213f6d00ef'>مصرف کردن بسته‌ها در سمت سرور (یونیتی)</h2>
<p>برای این کار بایستی، کد <code>purchasePackageId</code> که بخشی از کلاس <code>SibchePurchasePackage</code> می‌باشد را در دست داشته باشید. سپس لینکی به شکل زیر درست کنید و دیتای وریفای را از سرور بگیرید <strong>(آدرس‌ها Case sensitive هستند!)</strong>:</p>

<p><code>https://api.sibche.com/sdk/userInAppPurchasePackages/{purchasePackageId}/verifyConsume</code></p>

<p>همچنین برای این درخواست، بایستی هدر HTTP با اسم <code>App-Key</code> تنظیم نمایید. این کلید از طریق پنل توسعه‌دهندگان به صورت اختصاصی برای هر برنامه قابل دریافت است. اسم این کلید، <strong>کلید سرور</strong> نام دارد و عبارت ۳۰ کاراکتری است.</p>
<pre class="highlight shell tab-shell"><code>curl --header <span class="s2">"App-Key: YOUR_SERVER_KEY"</span> -X POST <span class="se">\</span>
<span class="s1">'https://api.sibche.com/sdk/userInAppPurchasePackages/1/verifyConsume'</span>
</code></pre>
<p>نمونه کد قابل فراخوانی برای curl به شکل روبرو خواهد بود:</p>

<p><br/>
<br/></p>

<p>در جواب، سرور پاسخی با یکی از <strong>HTTP Response Code</strong> های زیر خواهد داد:</p>

<ul>
<li>HTTP Status Code 404 (Not Found):</li>
</ul>

<p>در صورتی که آدرس لینک را اشتباه وارد کرده باشید، یا بسته مورد نظر با purchasePackageId اشتباه وارد شده باشد، یا بسته مورد نظر قبلا مصرف شده باشد این خطا رخ خواهد داد.<br>
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"your package is already is used or not found"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 401 (Unauthorized):</li>
</ul>

<p>یعنی اینکه کلید سروری که بر روی App-Key تنظیم شده است، غیر معتبر و اشتباه است.
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"app-key is not valid"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 202 (Accepted / OK):</li>
</ul>

<p>در این صورت یعنی، بسته مورد نظر با موفقیت مصرف شد و خرید کاربر، معتبر بوده است.
برای این حالت،‌ سرور در متن پاسخ، هیچ نوشته‌ای بر نخواهد گرداند.</p>
<h2 id='0fd9870786'>درخواست وارد شدن کاربر داخل پلاگین سیبچه (کرونا)</h2>
<aside class="success">
توصیه می‌کنیم از این بخش به صورت دستی استفاده نکنید چرا که در فرآیند پرداخت، اگر کاربر لاگین نکرده باشد، کتابخانه سیبچه خود اقدام به لاگین کاربر می‌کند.
</aside>
<pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">loginCallback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">loginUser</span><span class="p">(</span><span class="n">loginCallback</span><span class="p">)</span>
</code></pre>
<p>با استفاده از این دستور، میتوانید به کتابخانه سیبچه، درخواست لاگین کاربر را بدهید. کافیست همانند کد روبرو، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>

<p><br/>
<br/>
<br/></p>

<p>در جواب، پلاگین سیبچه، موفق بودن ورود (لاگین) و خطایی که با آن برخورد کرده را برمی‌گرداند. همچنین، در صورت موفقیت و در صورت موجود بودن، نام کاربر و آیدی کاربر را برمی‌گرداند.</p>
<h2 id='b04669d089'>درخواست خارج شدن کاربر از پلاگین سیبچه (کرونا)</h2>
<aside class="warning">
توصیه می‌کنیم، تا زمانی که دلیل مشخصی جهت استفاده از آن را ندارید، از این تابع استفاده ننمایید. چرا که دکمه خروج داخل پلاگین سیبچه پیاده‌سازی شده است.
</aside>
<pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">logoutCallback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">logoutUser</span><span class="p">(</span><span class="n">logoutCallback</span><span class="p">)</span>
</code></pre>
<p>با استفاده از این دستور می‌توانید کاربر فعلی لاگین کرده داخل سیستم را از پلاگین خارج نمایید و کلیه اطلاعات session او را پاک نمایید.
این تابع پس از اتمام کار، در قالب callback به شما جواب خواهد داد.</p>
<h2 id='36767fbe2a'>گرفتن اطلاعات کاربر فعلی (کرونا)</h2><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">getCurrentUserCallback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="k">end</span>

<span class="n">SibcheStoreKit</span><span class="p">.</span><span class="n">getCurrentUserData</span><span class="p">(</span><span class="n">getCurrentUserCallback</span><span class="p">)</span>
</code></pre>
<p>زمانی که نیاز دارید تا شماره تلفن و نیز شماره کاربری (userId) کاربر را دریافت نمایید، می‌توانید از تابع روبرو استفاده نمایید.</p>

<p><br/>
<br/>
<br/></p>

<p>در جواب، کیت توسعه‌دهندگان، نتیجه موفق بودن عملیات و نیز ارور رخ داده را برمی‌گرداند. در حالت عادی، بایستی عملیات موفق باشد ولی ناموفق بودن عملیات می‌تواند به دلایل شبکه‌ای مختلفی همانند موارد زیر باشد:</p>

<ul>
<li>دسترسی به اینترنت مقدور نبود</li>
<li>هر اتفاق ناخواسته شبکه‌ای رخ داده است</li>
<li>سرور سیبچه در دسترس نیست</li>
</ul>

<p>همچنین در جواب، پارامتر سومی هم دارد که وضعیت کاربر را از لحاظ لاگین بودن/نبودن به اطلاع شما می‌رساند. در صورتی که لاگین باشد، از نوع <code>‍loginStatusTypeIsLoggedIn‍‍</code> جواب خواهد داد. در صورت لاگین نبودن نیز جواب داده شده از نوع <code>loginStatusTypeIsLoggedOut</code> می‌باشد. در صورتی که عملیات ناموفق باشد و از وضعیت لاگین بودن کاربر مطمئن نباشیم نیز جواب ‍<code>loginStatusTypeHaveTokenButFailedToCheck</code> را خواهیم داد.
پارامتر‌های بعدی نیز شامل شماره تلفن کاربر و نیز id کاربر می‌باشد که در پاسخ به شما داده خواهد شد.</p>
<h1 id='c7bda9ded8'>نصب کیت توسعه‌دهندگان ری‌اکت نیتیو</h1><h2 id='c3ccac9166'>نیازمندیهای نصب کیت توسعه دهندگان</h2>
<ol>
<li>بارگذاری برنامه در <a href="https://sibche.com/developer">پنل توسعه‌دهندگان سیبچه</a></li>
<li>دریافت کلید برنامه از پنل توسعه‌دهندگان</li>
<li>آخرین نسخه‌ی Xcode</li>
</ol>
<h2 id='c7bda9ded8-2'>نصب کیت توسعه‌دهندگان ری‌اکت نیتیو</h2><pre class="highlight shell"><code>npm install --save react-native-sibche-storekit

<span class="c">## OR</span>

yarn add react-native-sibche-storekit
</code></pre>
<p>کافی است در داخل پروژه ری‌اکت خود دستور روبرو را اجرا نمایید. با این کار، پکیج سیبچه بر روی پروژه شما نصب خواهد شد.</p>

<blockquote>
<p>سپس از طریق پاد، پلاگین سیبچه را نصب نمایید</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>pod repo update
pod install
</code></pre><h2 id='db41eec830'>تنظیمات اولیه</h2><h3 id='scheme'>افزودن Scheme مختص برنامه شما</h3>
<aside class="success">
اگر برنامه شما دارای scheme اختصاصی می‌باشد این مرحله را رد کنید.
</aside>

<p>برای اضافه کردن scheme اختصاصی بایستی طبق مراحل زیر تنظیمات برنامه را داخل Xcode باز کرده و سپس به تب info مراجعه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc10.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc10.jpg"/>
</a></p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc11.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc11.jpg"/>
</a></p>

<p>سپس همانند شکل، url اختصاصی اپلیکیشن را اضافه نمایید:</p>

<p><a href="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc12.jpg">
    <img src="https://raw.githubusercontent.com/sibche/SibcheStoreKit/master/Screenshots/sc12.jpg"/>
</a></p>

<p>به جای test، نام دلخواهی را تنظیم کرده و به جای testapp بایستی scheme مورد نظرتان را وارد نمایید. به عنوان مثال scheme تنظیم شده <strong>تلگرام</strong> <code>tg</code> و scheme تنظیم شده برای برنامه <strong>اینستاگرام</strong> <code>instagram</code> میباشد. لیست کامل scheme برنامه‌های معروف را میتوانید از
<a href="https://ios.gadgethacks.com/news/always-updated-list-ios-app-url-scheme-names-0184033/">اینجا</a>
مشاهده نمایید.</p>

<aside class="warning">
توصیه اکید می‌شود از scheme استفاده کنید که مختص شما باشد و ترجیحا طولانی باشد. توجه فرمایید که اگر با برنامه‌های دیگر در تداخل باشد، در فرآیند پرداخت دچار مشکل خواهید شد.
</aside>
<h3 id='appdelegate'>افزودن کیت توسعه‌دهنده به AppDelegate</h3><pre class="highlight objective_c tab-objective_c"><code><span class="cp">#import "AppDelegate.h"
#import &lt;SibcheStoreKit/SibcheStoreKit.h&gt;
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">application</span><span class="p">:(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
<span class="p">{</span>
  <span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">initWithApiKey</span><span class="p">:</span><span class="n">YOUR_API_KEY</span> <span class="nf">withScheme</span><span class="p">:</span><span class="n">YOUR_SCHEME</span><span class="p">];</span>

  <span class="n">RCTBridge</span> <span class="o">*</span><span class="n">bridge</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RCTBridge</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithDelegate</span><span class="p">:</span><span class="n">self</span> <span class="nf">launchOptions</span><span class="p">:</span><span class="n">launchOptions</span><span class="p">];</span>
  <span class="n">RCTRootView</span> <span class="o">*</span><span class="n">rootView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RCTRootView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithBridge</span><span class="p">:</span><span class="n">bridge</span>
                                                   <span class="nf">moduleName</span><span class="p">:</span><span class="s">@"CallRecorder"</span>
                                            <span class="nl">initialProperties:</span><span class="nb">nil</span><span class="p">];</span>
  <span class="p">...</span>
<span class="p">}</span>                                            
</code></pre>
<p>ابتدا کد اجرای کیت توسعه‌دهندگان را داخل تابع <code>didFinishLaunchingWithOptions</code> اضافه نمایید:</p>

<p>(برای دیدن کد این قسمت، بایستی از تب بالا، زبان Objective-c را انتخاب نمایید)</p>

<p><br/></p>

<p>لازم به ذکر است که به جای <code>YOUR_API_KEY</code> بایستی کلید برنامه گرفته شده از پنل توسعه‌دهندگان سیبچه را قرار دهید و به جای <code>YOUR_SCHEME</code> واژه scheme اضافه شده در مرحله قبل را جایگذاری نمایید.</p>

<p><br/>
<br/>
<br/></p>
<pre class="highlight objective_c tab-objective_c"><code><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">application</span><span class="p">:(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">openURL</span><span class="p">:(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span>
  <span class="nf">sourceApplication</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">sourceApplication</span> <span class="nf">annotation</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">annotation</span>
<span class="p">{</span>
  <span class="p">[</span><span class="n">SibcheStoreKit</span> <span class="nf">openUrl</span><span class="p">:</span><span class="n">url</span> <span class="nf">options</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">RCTLinkingManager</span> <span class="nf">application</span><span class="p">:</span><span class="n">application</span> <span class="nf">openURL</span><span class="p">:</span><span class="n">url</span>
                      <span class="nl">sourceApplication:</span><span class="n">sourceApplication</span> <span class="n">annotation</span><span class="o">:</span><span class="n">annotation</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
<p>سپس امکان فراخوانی باز شدن url را نیز به کیت توسعه‌دهندگان بدهید:</p>
<h2 id='5a60f35ea5'>کلاس‌های مورد استفاده در کیت توسعه‌دهندگان</h2>
<p>برای خرید، فعال‌سازی و استفاده از بسته‌های سیبچه، کلاسهای زیر ایجاد شده است که در ادامه در مورد هر کدام توضیحاتی ارائه خواهیم کرد.</p>

<ul>
<li><p><code>SibchePackage</code>:
این کلاس، نمایانگر بسته قابل خریدی هست که داخل پنل توسعه‌دهندگان اقدام به تعریفشان کرده‌اید. </p></li>
<li><p><code>SibchePurchasePackage</code>:
این کلاس، نمایانگر خرید متناظری از کاربر هست که به یک بسته SibchePackage اختصاص یافته است. این کلاس، شامل اطلاعات خرید، زمان خرید، و تاریخ انقضا و ... خواهد بود.</p></li>
<li><p><code>SibcheError</code>:
این کلاس، در مواقع رخداد خطا به شما ارجاع داده خواهد شد که شامل اطلاعات بیشتر از خطاهای رخ داده است. اطلاعاتی از قبیل خطا و Http status code و ...</p></li>
</ul>
<h3 id='sibchepackage'>SibchePackage</h3>
<p>سه نوع بسته قابل خرید داریم که عبارتند از:</p>

<ul>
<li>بسته‌های قابل خرید مصرفی یا <code>SibcheConsumablePackage</code>:
بسته‌هایی که قابل مصرف هستند که خریداری شده و داخل بازی یا برنامه مصرف می‌شود. مانند بسته‌ی ۵۰۰ سکه طلا یا شارژ قابل مصرف داخل برنامه.</li>
</ul>

<p>این بسته ها تا زمانی که مصرف نشده‌اند، فعال و معتبر می‌باشند و پس از مصرف، قابل خرید مجدد هستند. </p>

<ul>
<li>بسته‌های قابل خرید غیر مصرفی یا <code>SibcheNonConsumablePackage</code>:
بسته‌هایی که قابل مصرف نیستند و فقط یکبار خریداری می‌شوند. مانند بسته‌ی باز شدن قابلیت آپلود آواتار یا تغییر نام.</li>
</ul>

<p>این بسته ها، فقط یکبار قابل خرید هستند و پس از خرید، همواره در لیست بسته‌های فعال کاربر خواهند بود.</p>

<ul>
<li>بسته‌های اشتراک یا <code>SibcheSubscriptionPackage</code>:
بسته‌هایی هستند که به مدت محدود قابل استفاده بوده و پس از اتمام زمان آنها، کاربر مجاز به استفاده از آن قابلیت نیست. به عنوان مثال، قابلیت استفاده از امکانات ویژه به مدت یک سال</li>
</ul>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="nl">packageId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">type</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">code</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">packageDescription</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">price</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">totalPrice</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">discount</span><span class="p">:</span> <span class="nx">number</span>
<span class="p">}</span>
</code></pre>
<p>همه این سه مدل از مدل والد <code>SibchePackage</code> گرفته شده‌اند و به صورت عمومی شامل توابع روبرو هستند.</p>

<p><br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/></p>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="nl">duration</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">group</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">}</span>
</code></pre>
<p>علاوه بر این توابع، کلاس <code>SibcheSubscriptionPackage</code> شامل توابع اضافی تر روبرو نیز هست:</p>

<p><br/></p>
<h3 id='sibchepurchasepackage'>SibchePurchasePackage</h3><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="nl">purchasePackageId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">type</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">code</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">expireAt</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">createdAt</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="kr">package</span><span class="p">:</span> <span class="nx">SibchePackage</span>
<span class="p">}</span>
</code></pre>
<p>این کلاس، شامل تناظر خرید کاربر به بسته‌های شما می‌باشد. این کلاس شامل توابع روبروست:</p>

<p><br/>
<br/>
<br/></p>
<h3 id='sibcheerror'>SibcheError</h3><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="nl">errorCode</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">statusCode</span><span class="p">:</span> <span class="nx">number</span>
<span class="p">}</span>
</code></pre>
<p>این کلاس در مواقع بروز خطا به شما داده خواهد شد و شامل خصوصیات روبرو می‌باشد:</p>

<p><br/>
<br/></p>

<ul>
<li>errorCode: همان شماره خطایی هست که مطابق جدول زیر ایجاد شده است.</li>
<li>message: پیغام خطایی هست که از طرف سرور دریافت شده است.</li>
<li>statusCode:  همان شماره خطای http هست که سرور در جواب درخواست ما داده است.</li>
</ul>

<table><thead>
<tr>
<th>شماره errorCode</th>
<th>دلیل خطای مربوطه</th>
</tr>
</thead><tbody>
<tr>
<td>1000</td>
<td>خطای نامشخص</td>
</tr>
<tr>
<td>1001</td>
<td>این بسته قبلا خریداری شده است</td>
</tr>
<tr>
<td>1002</td>
<td>کاربر از ادامه عملیات منصرف شد</td>
</tr>
<tr>
<td>1003</td>
<td>در فرایند ورود (لاگین) دچار مشکل شده‌ایم</td>
</tr>
<tr>
<td>1004</td>
<td>برنامه به درستی initiate نشده است</td>
</tr>
</tbody></table>
<h2 id='c9f8a646e3'>گرفتن لیست بسته‌های قابل خرید</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">SibcheStoreKit</span> <span class="nx">from</span> <span class="s2">"react-native-sibche-storekit"</span><span class="p">;</span>


<span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">fetchInAppPurchasePackages</span><span class="p">((</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">packagesArray</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">packagesArray</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>پس از تنظیم برنامه، میتوانید بسته‌های قابل خرید را مشاهده نمایید. کافیست همانند کد روبرو اقدام به فراخوانی تابع مورد نظر نمایید:</p>

<p><br/></p>

<p>در پاسخ، در صورت موفقیت، کیت توسعه‌دهندگان بسته‌های قابل خرید را به عنوان پارامتر پاسخ به شما تحویل میدهد. این پارامتر آرایه‌ای از بسته‌های قابل خرید می‌باشد. این بسته‌ها از نوع <code>SibchePackage</code> هستند. </p>

<p>در صورت ناموفق بودن درخواست، پارمتری با نام error از نوع <code>‍‍SibcheError</code> ارسال می‌شود.</p>
<h2 id='78717ca14a'>گرفتن اطلاعات بسته مشخص</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">fetchInAppPurchasePackage</span><span class="p">(</span><span class="nx">PACKAGE_ID_OR_CODE</span><span class="p">,</span> <span class="p">(</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">packageItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"=====&gt; specific package"</span><span class="p">,</span> <span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">packageItem</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>با در اختیار داشتن آیدی یا کد باندل بسته مورد نظر می‌توانید اطلاعات آن بسته را در اختیار بگیرید. نحوه استفاده از این API به شکل روبرو است:</p>

<p><br/></p>

<p>پارامتر اول داده شده، همان callback ارسال شده ما است که پس از مشخص شدن وضعیت درخواست، فراخوانی خواهد شد. در صورت موفقیت، بسته‌ی مورد نظر در قالب آبجکت <code>SibchePackage</code> (بسته به نوع بسته) به شما ارسال خواهد شد.</p>
<h2 id='24a3f3148b'>خرید بسته مشخص</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">purchasePackage</span><span class="p">(</span><span class="s2">"ava.test"</span><span class="p">,</span> <span class="p">(</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">purchasePackage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Result of purchase"</span><span class="p">,</span> <span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">purchasePackage</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isSuccessful</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Success block</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="c1">// Failure block</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>پس از گرفتن لیست بسته‌ها، میتوانید درخواست خرید این بسته‌ها را از طریق کد روبرو به کیت توسعه‌دهندگان بدهید. در ادامه، کیت توسعه‌دهندگان، در صورت نیاز کاربر را لاگین کرده و فرایند پرداخت را پیگیری خواهد کرد. سپس موفق یا ناموفق بودن خرید را به همراه <code>SibchePurchasePackage</code> به اطلاع شما خواهد رساند.</p>

<p><br/></p>
<h2 id='a0e825d6e5'>گرفتن لیست بسته های خریداری شده</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">fetchActiveInAppPurchasePackages</span><span class="p">((</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">purchasePackagesArray</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"=====&gt; Active pacakges"</span><span class="p">,</span> <span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">purchasePackagesArray</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>با استفاده از این دستور، میتوانید لیست بسته‌های فعال (خریداری شده) کاربر را بدست آورید. کافیست همانند کد روبر، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>

<p><br/>
<br/></p>

<p>در پاسخ، کیت توسعه‌دهندگان موفقیت/عدم موفقیت درخواست و نیز آرایه‌ای از بسته‌های خریداری شده‌ی فعال را برمی‌گرداند. توجه نمایید که این آرایه، آرایه‌ای از نوع <code>SibchePurchasePackage</code> است.</p>

<p>منظور از بسته‌های فعال، بسته‌هایی هستند که خریداری شده‌اند و هنوز مصرف نشده‌اند و یا تاریخ انقضایشان به اتمام نرسیده است.
تعریف سیبچه از بسته‌های فعال برای هر کدام از نوع بسته‌ها به شرح زیر می‌باشد:</p>

<ul>
<li><code>SibcheConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز مصرف (Consume) نشده‌اند.</li>
<li><code>SibcheNonConsumablePackage</code>: بسته‌هایی که خریداری شده‌اند. چون این بسته‌ها یکبار خرید هستند، در صورت خرید، به صورت مادام‌العمر فعال هستند.</li>
<li><code>SibcheSubscriptionPackage</code>: بسته‌هایی که خریداری شده‌اند ولی هنوز از تاریخ انقضای آنها باقی مانده است.</li>
</ul>
<h2 id='0c1fd2b399'>مصرف کردن بسته‌ها در سمت کلاینت</h2>
<aside class="success">
در صورتی که بخواهید بسته‌های قابل مصرف را در سمت کلاینت (درون خود بازی/برنامه) مصرف کنید، بایستی از این روش استفاده کنید. ولی اگر قصد مصرف و اعتبارسنجی سمت سرور داشته باشید، به بخش بعدی مراجعه نمایید.
</aside>
<pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">consumePurchasePackage</span><span class="p">(</span><span class="nx">purchasePackage</span><span class="p">.</span><span class="nx">purchasePackageId</span><span class="p">,</span> <span class="p">(</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Result of consume"</span><span class="p">,</span> <span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>برای مصرف کردن بسته‌های قابل مصرف (Consumable) بایستی شبیه دستور روبرو، تابع مربوطه از کیت توسعه‌دهندگان را فراخوانی کنیم:</p>

<p>در پاسخ پس از مشخص شدن وضعیت درخواست، کیت توسعه‌دهندگان callback داده شده را فراخوانی خواهد کرد.
در صورت موفقیت، یعنی بسته مورد نظر با موفقیت مصرف شده و در صورت عدم موفقیت، در مصرف بسته مورد نظر، دچار مشکلی شده‌ایم.</p>
<h2 id='11d829c26b'>مصرف کردن بسته‌ها در سمت سرور</h2>
<p>برای این کار بایستی، کد <code>purchasePackageId</code> که بخشی از کلاس <code>SibchePurchasePackage</code> می‌باشد را در دست داشته باشید. سپس لینکی به شکل زیر درست کنید و دیتای وریفای را از سرور بگیرید <strong>(آدرس‌ها Case sensitive هستند!)</strong>:</p>

<p><code>https://api.sibche.com/sdk/userInAppPurchasePackages/{purchasePackageId}/verifyConsume</code></p>

<p>همچنین برای این درخواست، بایستی هدر HTTP با اسم <code>App-Key</code> تنظیم نمایید. این کلید از طریق پنل توسعه‌دهندگان به صورت اختصاصی برای هر برنامه قابل دریافت است. اسم این کلید، <strong>کلید سرور</strong> نام دارد و عبارت ۳۰ کاراکتری است.</p>
<pre class="highlight shell tab-shell"><code>curl --header <span class="s2">"App-Key: YOUR_SERVER_KEY"</span> -X POST <span class="se">\</span>
<span class="s1">'https://api.sibche.com/sdk/userInAppPurchasePackages/1/verifyConsume'</span>
</code></pre>
<p>نمونه کد قابل فراخوانی برای curl به شکل روبرو خواهد بود:</p>

<p><br/>
<br/></p>

<p>در جواب، سرور پاسخی با یکی از <strong>HTTP Response Code</strong> های زیر خواهد داد:</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"your package is already is used or not found"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 404 (Not Found):
در صورتی که آدرس لینک را اشتباه وارد کرده باشید، یا بسته مورد نظر با purchasePackageId اشتباه وارد شده باشد، یا بسته مورد نظر قبلا مصرف شده باشد این خطا رخ خواهد داد.<br>
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</li>
</ul>

<p><br/>
<br/></p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"app-key is not valid"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>HTTP Status Code 401 (Unauthorized):
یعنی اینکه کلید سروری که بر روی App-Key تنظیم شده است، غیر معتبر و اشتباه است.
در این صورت، سرور در متن پاسخ، پاسخی شبیه روبرو خواهد داد:</li>
</ul>

<p><br/>
<br/></p>

<ul>
<li>HTTP Status Code 202 (Accepted / OK):
در این صورت یعنی، بسته مورد نظر با موفقیت مصرف شد و خرید کاربر، معتبر بوده است.
برای این حالت،‌ سرور در متن پاسخ، هیچ نوشته‌ای بر نخواهد گرداند.</li>
</ul>
<h2 id='login'>درخواست وارد شدن (Login) کاربر به کیت توسعه‌دهندگان سیبچه</h2>
<aside class="warning">
توصیه می‌کنیم از این بخش به صورت دستی استفاده نکنید چرا که در فرآیند پرداخت، اگر کاربر لاگین نکرده باشد، کتابخانه سیبچه خود اقدام به لاگین کاربر می‌کند.
</aside>
<pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">loginUser</span><span class="p">((</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">userName</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isSuccessful</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Successful login</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="c1">// Failed login</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre>
<p>با استفاده از این دستور، میتوانید به کتابخانه سیبچه، درخواست لاگین کاربر را بدهید. کافیست همانند کد روبر، تابع مربوطه کیت توسعه‌دهندگان را فراخوانی نمایید.</p>

<p><br/>
<br/></p>

<p>در جواب، کیت توسعه دهندگان، موفقیت لاگین و اروری که بهش برخورده را برمیگرداند. همچنین، در صورت موفقیت و در صورت موجود بودن، نام کاربر و آیدی کاربر را برمی‌گرداند.</p>
<h2 id='logout'>درخواست خارج شدن (Logout) کاربر از کیت توسعه‌دهندگان سیبچه</h2>
<aside class="warning">
توصیه اکید میکنیم، زمانی از این تابع استفاده نمایید که کاربر دکمه بازیابی خرید را زده و درخواست بازیابی خرید خود را دارد.
</aside>
<pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">logoutUser</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Logging out finished"</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
<p>با استفاده از این دستور می‌توانید کاربر فعلی لاگین کرده داخل سیستم را از کیت توسعه‌دهندگان خارج نمایید و کلیه اطلاعات session او را پاک نمایید.
این تابع پس از اتمام کار، در قالب callback به شما جواب خواهد داد.</p>
<h2 id='82c79511e7'>گرفتن اطلاعات کاربر فعلی</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">SibcheStoreKit</span><span class="p">.</span><span class="nx">getCurrentUserData</span><span class="p">((</span><span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">loginStatus</span><span class="p">,</span> <span class="nx">userCellphoneNumber</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Get current user data"</span><span class="p">,</span> <span class="nx">isSuccessful</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">loginStatus</span><span class="p">,</span> <span class="nx">userCellphoneNumber</span><span class="p">,</span> <span class="nx">userId</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
<p>زمانی که نیاز دارید تا شماره تلفن و نیز شماره کاربری (userId) کاربر را دریافت نمایید، می‌توانید از تابع روبرو استفاده نمایید.</p>

<p><br/>
<br/></p>

<p>در جواب، کیت توسعه‌دهندگان، نتیجه موفق بودن عملیات و نیز ارور رخ داده را برمی‌گرداند. در حالت عادی، بایستی عملیات موفق باشد ولی ناموفق بودن عملیات می‌تواند به دلایل شبکه‌ای مختلفی همانند موارد زیر باشد:</p>

<ul>
<li>دسترسی به اینترنت مقدور نبود</li>
<li>هر اتفاق ناخواسته شبکه‌ای رخ داده است</li>
<li>سرور سیبچه در دسترس نیست</li>
</ul>

<p>همچنین در جواب، پارامتر سومی هم دارد که وضعیت کاربر را از لحاظ لاگین بودن/نبودن به اطلاع شما می‌رساند. در صورتی که لاگین باشد، از نوع <code>‍loginStatusTypeIsLoggedIn‍‍</code> جواب خواهد داد. در صورت لاگین نبودن نیز جواب داده شده از نوع <code>loginStatusTypeIsLoggedOut</code> می‌باشد. در صورتی که عملیات ناموفق باشد و از وضعیت لاگین بودن کاربر مطمئن نباشیم نیز جواب ‍<code>loginStatusTypeHaveTokenButFailedToCheck</code> را خواهیم داد.
پارامتر‌های بعدی نیز شامل شماره تلفن کاربر و نیز id کاربر می‌باشد که در پاسخ به شما داده خواهد شد.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="swift">Swift</a>
                <a href="#" data-language-name="objective_c">Objective-C</a>
                <a href="#" data-language-name="csharp">C#</a>
                <a href="#" data-language-name="lua">Lua</a>
                <a href="#" data-language-name="javascript">Javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
